{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "title: \"Onyxia: l'infrastructure cloud m√®re des dragons\"\n",
        "subtitle: Un projet autour d'une infrastructure de data science √† la pointe\n",
        "description: |\n",
        "  Les technologies cloud sont incontournables dans l'√©cosyst√®me de la \n",
        "  donn√©e. Pour ne pas se rendre d√©pendante de fournisseurs de services\n",
        "  externes, l'Insee a d√©velopp√© un datalab avec des technologies\n",
        "  √† la pointe pour ses data scientists. Le code source de celle-ci \n",
        "  a √©t√© ouvert dans le cadre du projet Onyxia. Ce projet permet\n",
        "  de f√©d√©rer une large communaut√© d'utilisateurs mais aussi\n",
        "  d'organisations int√©ress√©es par le d√©veloppement d'une\n",
        "  plateforme souveraine de data science. \n",
        "\n",
        "image: featured.png\n",
        "\n",
        "authors:\n",
        "  - Lino Galiana\n",
        "\n",
        "categories:\n",
        "  - Insee\n",
        "  - onyxia\n",
        "  - sspcloud\n",
        "\n",
        "bibliography: references.bib\n",
        "\n",
        "# Date published\n",
        "date: 2023-05-10\n",
        "---\n",
        "\n",
        "\n",
        "`Onyxia` est un logiciel _open source_ d√©velopp√© par l‚ÄôInsee\n",
        "([disponible sur `Github` <i class=\"fa-brands fa-github\"></i>](https://github.com/InseeFrLab/onyxia-web))\n",
        "permettant de fournir un environnement de traitement de donn√©es √† l‚Äô√©tat de l‚Äôart.\n",
        "Principalement con√ßu pour permettre le travail interactif des data scientists,\n",
        "l‚Äôexp√©rience fournie avec `Onyxia`\n",
        "favorise √©galement la reproductibilit√© des travaux et leur mise en production.\n",
        "\n",
        "Le logiciel `Onyxia` est install√© par des organisations souhaitant cr√©er un _datalab_,\n",
        "c'est-√†-dire une plateforme interactive de traitement de donn√©es.\n",
        "Ces organisations ont toutes le point commun de vouloir construire une plateforme qui embrasse\n",
        "les technologies _cloud_ que sont la conteneurisation et le stockage objet tout en mettant √†\n",
        "disposition celles-ci dans un environnement _user-friendly_ o√π l'interconnexion entre ces\n",
        "diff√©rentes briques est g√©r√©e de mani√®re coh√©rente.\n",
        "Les technologies _cloud native_ sont devenues indispensables dans l‚Äô√©cosyst√®me de la donn√©e,\n",
        "du fait d'une meilleure gestion des ressources de traitement ou de la capacit√© √† cr√©er un\n",
        "environnement parfaitement reproductible pour une mise en production acc√©l√©r√©e.\n",
        "\n",
        "Ce _post_ de blog a pour objectif de pr√©senter la raison d'√™tre d'`Onyxia`,\n",
        "sa g√©n√®se et les solutions qu'apporte cette infrastructure √† des irritants\n",
        "classiques des projets novateurs de data science. \n",
        "\n",
        "## Contexte\n",
        "\n",
        "L'√©cosyst√®me de la data science est en mouvement acc√©l√©r√© depuis 10 ans\n",
        "et le r√¥le du _data scientist_ dans les organisations valorisant de la donn√©e\n",
        "√©volue continuellement [@davenport2022data]. \n",
        "Les data scientists modernes sont amen√©s √† utiliser de plus en plus\n",
        "de langages et doivent √™tre capables de ma√Ætriser plusieurs\n",
        "architectures informatiques. La fronti√®re est ainsi moins nette\n",
        "que par le pass√© entre\n",
        "statisticiens et informaticiens. \n",
        "De plus, les innovations r√©centes dans le monde du\n",
        "d√©veloppement logiciel, notamment \n",
        "l'adoption massive de l'approche `DevOps` -\n",
        "approche qui consiste √† automatiser la production de livrables d√®s la conception\n",
        "du prototype -\n",
        "a √©galement fait √©voluer les pratiques des data scientists.\n",
        "\n",
        "Ce besoin de ressources informatiques croissantes, \n",
        "de flexibilit√© dans le prototypage de solutions informatiques et l'√©volution des\n",
        "pratiques\n",
        "consistant √† mettre √† disposition en continu des livrables ont eu des implications\n",
        "importantes sur les architectures informatiques dominantes dans l'√©cosyst√®me de la \n",
        "donn√©e.\n",
        "Pour r√©pondre au besoin croissant de puissance de traitement, les serveurs\n",
        "partag√©s, organis√©s sous forme de _clusters_, se sont d√©velopp√©s dans de \n",
        "nombreuses organisations.\n",
        "Apr√®s avoir connue son heure de gloire au d√©but des ann√©es 2010, l'infrastructure\n",
        "[`HDFS` (_Hadoop Distributed File System_)](https://openclassrooms.com/fr/courses/4467481-creez-votre-data-lake/4509426-decouvrez-le-systeme-de-fichiers-distribue-hdfs), \n",
        "qui reposait sur des _clusters_ o√π les donn√©es et la puissance de traitement √©taient\n",
        "distribu√©es et collocalis√©es, a laiss√© place √† des infrastructures\n",
        "plus _scalables_, bas√©es sur l'approche de la conteneurisation. \n",
        "\n",
        "## De HDFS √† la conteneurisation\n",
        "\n",
        "::: {.callout-note}\n",
        "Cette partie plus technique d√©veloppe des √©l√©ments pour comprendre\n",
        "le succ√®s r√©cent des infrastructures conteneuris√©es. \n",
        "\n",
        "Elle pourra int√©resser le lecteur curieux sur les fondements\n",
        "des infrastructures _cloud_ modernes mais n'est pas n√©cessaire\n",
        "√† la compr√©hension g√©n√©rale de l'article.\n",
        ":::\n",
        "\n",
        "La conteneurisation, qui repose\n",
        "sur l'id√©e que les serveurs de stockage de la donn√©e peuvent √™tre dissoci√©s de ceux\n",
        "effectuant les traitements, sert de fondement aux principales plateformes _cloud_ actuelles\n",
        "fournissant \n",
        "des services √† la demande.\n",
        " \n",
        "Ce nouveau paradigme part de deux constats. Le premier\n",
        "est que les\n",
        "√©changes de donn√©es entre les noeuds d'un serveur sont aujourd'hui peu co√ªteux.\n",
        "Avec des flux r√©seaux suffisants et une technologie\n",
        "performante, \n",
        "il est donc possible d'√©changer √† un co√ªt mod√©r√©\n",
        "de gros volumes de donn√©es au sein d'une infrastructure.\n",
        "Le deuxi√®me constat est que la maintenance d'une infrastructure conteneuris√©e,\n",
        "faite pour √™tre tr√®s mall√©able, est\n",
        "plus l√©g√®re que celle d'une infrastructure bas√©e sur des machines virtuelles ou sur\n",
        "les infrastructrures calibr√©es pour l'analytique _big data_ comme `HDFS` reposant\n",
        "sur la collocalisation des donn√©es et des traitements[^1].\n",
        "\n",
        "[^1]: On peut ajouter que cette question n'est pas exclusivement technologique. \n",
        "M√™me s'il est volontairement pol√©mique,\n",
        "l'article de [Jordan Tigani \"Big Data is Dead\"](https://motherduck.com/blog/big-data-is-dead/)\n",
        "illustre bien le changement de paradigme du monde de la _tech_. \n",
        "\n",
        " \n",
        "Les donn√©es √©tant stock√©es sur des serveurs diff√©rents de ceux ex√©cutant les traitements,\n",
        "l'acc√®s √† celles-ci se fait √† travers des API qui \n",
        "permettent de traiter le syst√®me de stockage distant comme un syst√®me de fichiers\n",
        "classique. `Onyxia` a adopt√© une impl√©mentation _open source_ du syst√®me de stockage\n",
        "[`S3`](https://fr.wikipedia.org/wiki/Amazon_S3) appel√©e [`MinIO`](https://min.io/).\n",
        "\n",
        "En ce qui concerne le traitement des donn√©es, le fait\n",
        "d'utiliser un syst√®me de conteneurs, c'est-√†-dire une configuration logicielle portable minimaliste\n",
        "pr√™te √† l'emploi (par opposition aux machines virtuelles qui impliquent un syst√®me d'exploitation complet), \n",
        "offre une grande libert√© sur le choix des logiciels de traitement. De nombreuses technologies \n",
        "_open source_ devenues standards dans le monde de la _data science_ (`Jupyter`, `RStudio`, `ElasticSearch`...) \n",
        "existent d√©j√† sous cette forme et peuvent ainsi √™tre adopt√©es dans une telle infrastructure pour fournir\n",
        "des services pr√™ts-√†-l'emploi pour les data scientists.\n",
        "La mise en \n",
        "musique de toutes ces petites boites auto-suffisantes, notamment l'optimisation des ressources concurrentes\n",
        "sur un serveur, est permise par la technologie d'orchestration [`Kubernetes`](https://kubernetes.io/fr/).\n",
        "\n",
        "<br>"
      ],
      "id": "68a8f173"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| output: asis\n",
        "#| echo: false\n",
        "with open('onyxia_logic.svg') as f:\n",
        "    s = f.read()\n",
        "print(s)"
      ],
      "id": "6a7021cc",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "_Centralisation des ressources par `Onyxia`_\n",
        "\n",
        "<br>\n",
        "\n",
        "\n",
        "::: {.callout-note collapse=\"true\"}\n",
        "## Plus de d√©tails pour comprendre le changement de paradigme vers la conteuneurisation üëá\n",
        "\n",
        "\n",
        "Les infrastructures _big data_ reposent sur le principe du _cluster_ (grappe) informatique.\n",
        "Des serveurs sont connect√©s entre eux, ce qui forme de mani√®re imag√©e une grappe. \n",
        "Cette interconnexion de plusieurs serveurs entre eux peut se faire au niveau :\n",
        "\n",
        "- du **stockage** : les donn√©es volumineuses ne sont pas stock√©es sur un seul serveur mais au contraire r√©parties ;\n",
        "- du **traitement** : les calculs sont effectu√©s par blocs sur plusieurs serveurs et le r√©sultat\n",
        "de ceux-ci est ensuite transmis √† un serveur ma√Ætre. \n",
        "\n",
        "Le syst√®me _Hadoop Distributed File System_ a √©t√© pens√© pour tirer parti\n",
        "de l'algorithme de traitement\n",
        "parall√©lis√© [`MapReduce`](https://fr.wikipedia.org/wiki/MapReduce) propos√© en 2004\n",
        "par `Google`. Les fichiers\n",
        "volumineux sont fractionn√©s et r√©partis sur plusieurs serveurs.\n",
        "\n",
        "![](https://i0.wp.com/datascientest.com/wp-content/uploads/2021/04/illu_schema_mapreduce-04.png?w=1024&ssl=1)\n",
        "\n",
        "_Fonctionnement d'une architecture `MapReduce` (source: [Datascientest](https://datascientest.com/mapreduce))_\n",
        "\n",
        "La sp√©cificit√© de l'architecture `HDFS` est que non seulement le stockage est\n",
        "distribu√© mais √©galement aussi la puissance de traitement associ√©e.  On parle √†\n",
        "ce propos de __collocalisation__ : les traitements ont lieu sur les m√™mes serveurs\n",
        "que ceux o√π sont stock√©s les donn√©es. Cela permet\n",
        "de r√©duire les mouvements de donn√©es (_shuffle_ dans l'image ci-dessus) qui \n",
        "sont co√ªteux du point de vue de la performance.\n",
        "Cette collocalisation a permis au \n",
        "syst√®me `HDFS` de devenir, au d√©but de la d√©cennie 2010,\n",
        "le paradigme dominant. En\n",
        "tirant parti de la parall√©lisation\n",
        "permise par des langages tr√®s efficaces comme `Spark` tout en limitant les\n",
        "√©changes r√©seaux pouvant faire perdre en performance, cette \n",
        "architecture a attir√© au-del√† de l'√©cosyst√®me du _big data_. \n",
        "\n",
        "Le syst√®me HDFS pr√©sente n√©anmoins certaines limites qui expliquent sa\n",
        "perte de succ√®s avec l'√©mergence d'un nouveau paradigme plus flexible.\n",
        "\n",
        "En premier lieu,\n",
        "ce syst√®me n√©cessite beaucoup de ressources du fait de son _design_. Comme\n",
        "les traitements sont lourds et partag√©s pour des usages concurrents, \n",
        "les noeuds constituant le _cluster_ peuvent subir des arr√™ts √† cause\n",
        "de surcharge des ressources. \n",
        "Pour tenir\n",
        "compte de la nature instable de cette infrastructure _big data_,\n",
        "les fichiers \n",
        "sont dupliqu√©s. Ainsi, lors d'une erreur sur le\n",
        "serveur g√©n√©rant un arr√™t du n≈ìud \n",
        "(par exemple √† cause de traitements trop gourmands),\n",
        " les traitements sur l'ensemble\n",
        "des donn√©es sont s√©curis√©s √©vitant √©galement \n",
        "la perte partielle ou totale de ces derni√®res.\n",
        "\n",
        "L'implication est que les donn√©es, \n",
        "d√©j√† volumineuses, sont dupliqu√©es plusieurs fois \n",
        "impliquant des architectures assez monumentales. Si la duplication\n",
        "de la donn√©e n'est\n",
        "pas en soi choquante afin d'√©viter la perte de donn√©es,\n",
        "cela a un effet \n",
        "pervers dans un syst√®me de collocalisation. A chaque ajout de noeuds\n",
        "pour le stockage de donn√©es, il est √©galement n√©cessaire d'ajouter \n",
        "des ressources pour les traiter. Il est donc compliqu√© de d√©corr√©ler \n",
        "l'ajout de ressources de stockage et de traitement. Cette absence\n",
        "de flexibilit√© est p√©nalisante dans un monde o√π les donn√©es sont mises\n",
        "√† jour fr√©quemment et o√π les technologies de traitement, \n",
        "donc les besoins associ√©s, √©voluent rapidement. Les infrastructures `HDFS`\n",
        "sont donc lourdes √† changer, que ce soit pour ajouter des ressources\n",
        "ou faire √©voluer les distributions logicielles pr√©sentes dessus.\n",
        "\n",
        "Le deuxi√®me facteur qui a favoris√© le changement de paradigme est l'am√©lioration\n",
        "des √©changes r√©seaux. Il n'est plus aussi co√ªteux que par le pass√© de transf√©rer\n",
        "des volumes importants de donn√©es au sein d'une infrastructure. Cela facilite\n",
        "la d√©corr√©lation entre environnement de stockage et de traitement.\n",
        "\n",
        "Cette s√©paration\n",
        "des environnements de stockage et de traitement \n",
        "permet alors d'adopter pour chacun les technologies\n",
        "les plus performantes. Dans le domaine du stockage, celle qui \n",
        "a rencontr√© le plus de succ√®s est\n",
        "le syst√®me de stockage [`S3`](https://aws.amazon.com/fr/s3/) d√©velopp√©\n",
        "par Amazon. L'impl√©mentation _open source_ du syst√®me S3\n",
        "est [`MinIO`](https://min.io/), utilis√©e\n",
        "par `Onyxia`.\n",
        "\n",
        "Dans le domaine du traitement, la technologie la plus performante\n",
        "d√©pend de la nature de la t√¢che r√©alis√©e.\n",
        "Selon qu'on d√©sire effectuer de la recherche\n",
        "textuelle, des visualisations de donn√©es\n",
        "ou de l'analyse d'image, on ne va pas vouloir utiliser\n",
        "la m√™me technologie. Pour mettre √† disposition des logiciels\n",
        "sur un serveur, il existe principalement deux approches concurrentes.\n",
        "\n",
        "La premi√®re repose sur le principe des machines virtuelles. \n",
        "Cette approche n'est pas nouvelle et de nombreuses organisations ont\n",
        "propos√© ou proposent encore ce type d'infrastructures pour des serveurs\n",
        "collectifs de traitement. Cette approche est n√©anmoins lourde : elle n√©cessite\n",
        "un syst√®me d'exploitation complet dont il faudra ensuite adapter la configuration lors de\n",
        "l'installation de chaque logiciel. Plusieurs logiciels coexistent\n",
        "donc dans ce syst√®me\n",
        "d'exploitation m√™me si un seul, par exemple, `Python`, est utilis√©. \n",
        "Les machines virtuelles sont des infrastructures assez polluantes puisque pour\n",
        "faire fonctionner un syst√®me d'exploitation dans son ensemble, il\n",
        "est n√©cessaire de mobiliser des ressources plus importantes que celles seulement\n",
        "n√©cessaires aux traitements. \n",
        "De plus, la configuration d'un syst√®me d'exploitation, et notamment, la gestion\n",
        "de la d√©pendance de multiples logiciels √† des configurations syst√®mes qui\n",
        "peuvent ne pas correspondre, n'est pas triviale. Il est donc lourd de faire\n",
        "√©voluer une infrastructure reposant sur des machines virtuelles. \n",
        "L'absence de flexibilit√© d'une infrastructure reposant\n",
        "sur le principe des machines virtuelles est p√©nalisante\n",
        "dans un\n",
        "√©cosyst√®me mouvant comme celui de la _data science_, o√π une partie importante\n",
        "du travail de prototypage consiste √† tester plusieurs technologies \n",
        "pour d√©terminer celle s'int√©grant le mieux dans un processus de traitement\n",
        "de donn√©es. \n",
        "\n",
        "Le syst√®me de la conteneurisation a justement √©t√© pens√©\n",
        "pour cela : plut√¥t qu'installer de nombreuses librairies au niveau du syst√®me, pour une fraction \n",
        "d'utilisateurs limit√©e √† chacune,\n",
        "il est plus int√©ressant de cr√©er des environnements complets\n",
        "qui vont exister de mani√®re conjointe. Chaque _framework_ va √™tre construit comme\n",
        "un conteneur autosuffisant avec un syst√®me d'exploitation minime et un nombre\n",
        "minimal de couches de configurations suppl√©mentaires. Un _framework_ est livr√©\n",
        "sous la forme d'une\n",
        "image [`Docker`](https://fr.wikipedia.org/wiki/Docker_(logiciel)), une technologie\n",
        "qui permet d'empaqueter un logiciel et ses d√©pendances sous la forme de boites\n",
        "minimalistes et les mettre √† disposition facilement pour une r√©utilisation. \n",
        "Il existe par exemple des images `Docker` pour pouvoir utiliser `RStudio`, `Jupyter`,\n",
        "`VSCode`\n",
        "avec des configurations minimales afin d'ex√©cuter du `Python` ou du `R`. A partir de\n",
        "celles-ci, l'utilisateur qui d√©sire des configurations suppl√©mentaires\n",
        "peut ajouter les couches qui lui sont utiles. \n",
        "\n",
        "Mais les images `Docker` ne se r√©duisent pas √† la mise √† disposition\n",
        "d'environnements de d√©veloppement.\n",
        "Une partie des technologies les plus appr√©ci√©es de l'√©cosyst√®me de la\n",
        "data science sont √©galement livr√©es sous forme d'images `Docker`. Par\n",
        "exemple, le moteur de recherche `ElasticSearch`, tr√®s utilis√© pour\n",
        "la recherche textuelle, peut √™tre empaquet√© dans une\n",
        "image `Docker`. Le logiciel `Onyxia` propose d√®s lors, dans un catalogue vivant,\n",
        "un certain nombre\n",
        "de logiciels tr√®s utiles pour les _data scientists_ ayant fait l'objet d'un \n",
        "tel empaquetage. \n",
        "Les nombreuses images `Docker` servant √† cr√©er des services \n",
        "pour les _data scientists_ sont disponibles en _open source_ \n",
        "sur [`Github`](https://github.com/InseeFrLab/images-datascience).\n",
        "\n",
        "Pour organiser sur un serveur la coexistence \n",
        "de multiples utilisateurs de services gourmands en ressource, \n",
        "la solution [`Kubernetes`](https://kubernetes.io/fr/) fait\n",
        "aujourd'hui office de \n",
        "r√©f√©rence.\n",
        "Entre sa cr√©ation en 2014 et aujourd'hui, cette solution\n",
        "d'orchestration, c'est-√†-dire de gestion d'une infrastructure,\n",
        "est devenue incontournable. Outre son allocation dynamique\n",
        "des ressources, elle permet de transformer facilement\n",
        "le livrable d'une chaine de traitement\n",
        "en application disponible en continu. Ceci est\n",
        "particuli√®rement adapt√© dans un contexte de\n",
        "diversification\n",
        "des livrables fournis par les _data scientists_ (API, application web, mod√®le...)\n",
        "et d'adoption d'une d√©marche `DevOps` voire `MLOps`.\n",
        "\n",
        ":::\n",
        "\n",
        "## La solution Onyxia\n",
        "\n",
        "### D'un _cloud_ de l'administration √† un logiciel ouvert\n",
        "\n",
        "Pour permettre aux *data scientists* des administrations fran√ßaises\n",
        "de b√©n√©ficier de technologies _cloud_ sans √™tre d√©pendant d'un\n",
        "fournisseur de service priv√©,\n",
        "l'√©quipe innovation de l'Insee a eu l'id√©e de cr√©er un\n",
        "_datalab_ bas√© sur la philosophie de la conteneurisation en \n",
        "mobilisant exclusivement des composants open-source. \n",
        "\n",
        "Ce _datalab_, n√© √† l'Insee en 2018, a √©t√© ouvert √† l'administration\n",
        "publique sous la forme d'une instance https://www.sspcloud.fr/\n",
        "√† condition d'utiliser des donn√©es ouvertes. \n",
        "En plus des agents d√©j√† en poste dans l'administration,\n",
        "cette infrastructure sert depuis deux ans √† former les √©l√®ves de l'ENSAE et\n",
        "de l'ENSAI\n",
        "dans le cadre de leur formation en _data science_. \n",
        "\n",
        "D√©but 2023, ce sont plus de 3000 agents et √©tudiants qui sont inscrits \n",
        "sur cette infrastructure avec, en moyenne, 300 utilisateurs\n",
        "hebdomadaires. L'infrastructure de traitement propose 10 TB de RAM,\n",
        "1100 CPU disponibles et 34 GPU. La capacit√© de stockage associ√©e \n",
        "est de 150 TB. \n",
        "\n",
        "Pour les utilisations internes de donn√©es plus sensibles,\n",
        "l'√©quipe innovation\n",
        "de l'Insee a rendu disponible\n",
        "le code source derri√®re le `SSP Cloud`\n",
        "dans le cadre d'un logiciel\n",
        "nomm√© `Onyxia` (https://www.onyxia.sh/).\n",
        "Ce logiciel est pens√© comme un kit qui peut √™tre install√©\n",
        "sur un _cluster_ `Kubernetes`, technologie d√©taill√©e\n",
        "pr√©c√©demment. \n",
        "\n",
        "## Onyxia en bref\n",
        "\n",
        "\n",
        "![](onyxia_ecailles.svg)\n",
        "\n",
        "`Onyxia` propose principalement deux composants de valeur :\n",
        "\n",
        "* une __interface web__ qui agit comme la porte d‚Äôentr√©e du *data scientist* sur son datalab, lui facilitant l‚Äôacc√®s aux technologies cloud et lui permettant de d√©marrer ses environnements de traitement de la donn√©e. L'interface ergonomique permet aux utilisateurs de donn√©es n√©ophytes de d√©marrer des services standardis√©s sans se pr√©occuper de la configuration mais aussi aux *data scientists* plus aguerris de b√©n√©ficier de vastes possibilit√©s de personnalisation du service. \n",
        "* des __catalogues de logiciels__ : une petite vingtaine de services interactifs dont les plus utilis√©s sont `RStudio`, `Jupyter`, `VScode`, une quinzaine de services sp√©cialis√©s dans les bases de donn√©es (`Postgres`, `ElasticSearch`...),  5 services d‚Äôautomatisation (`MLflow`...) et 2 services de _dataviz_ (`Redash` et `Superset`)\n",
        "\n",
        "<img src = \"catalogue.svg\" alt=\"Le catalogue Onyxia\"/>\n",
        "\n",
        "_Le catalogue des services disponibles dans `Onyxia`._\n",
        "\n",
        "<br>\n",
        "\n",
        "Ces deux composants peuvent √™tre adapt√©s en fonction des besoins internes de chaque organisation.\n",
        "Tous les services interactifs sont automatiquement connect√©s √† l'espace de stockage `S3`,\n",
        "et au coffre de secret `Vault`. La gestion des droits d'acc√®s aux donn√©es stock√©es dans l'espace\n",
        "de stockage `S3` ou dans des services de bases de donn√©es (`ElasticSearch`, `PostGreSQL`...)\n",
        "est automatis√©e afin que chaque service\n",
        "puisse acc√©der aux donn√©es sur lesquelles l'utilisateur\n",
        "d√©tient des droits. \n",
        "\n",
        "`Onyxia` √©tant un ensemble mall√©able de logiciels conteneuris√©s,\n",
        "il est possible de ne pas adopter l'ensemble des services propos√©s par l'√©quipe de l'Insee qui maintient\n",
        "`Onyxia`. Il est √©galement possible de changer certaines des briques\n",
        "de base pour l'adapter √† des √©l√©ments d'infrastructure interne. Par exemple, il est possible d'adapter\n",
        "la destination du service de stockage ou les configurations des environnements data science pour l'adapter\n",
        "√† des ressources. \n",
        "\n",
        "## L'interface et les services propos√©s par `Onyxia`\n",
        "\n",
        "![_Onyxia offre des marges de manoeuvre sur l'interface_](multiple_instances.svg)\n",
        "\n",
        "\n",
        "L'une des principales forces d'`Onyxia` est d'offrir une multiplicit√© de services diff√©rents\n",
        "avec une interconnexion entre eux g√©r√©e de mani√®re coh√©rente. \n",
        "\n",
        "Les conteneurs sont d√©marr√©s comme des services √† la demande et la configuration automatique\n",
        "de ceux-ci permet d'assurer aux *data scientists* l'acc√®s aux donn√©es disponibles dans\n",
        "des espaces de stockage ou des bases de donn√©es cr√©√©es par l'utilisateur.\n",
        "\n",
        "Le catalogue de services se pr√©sente par le biais d'un formulaire ergonomique o√π l'utilisateur\n",
        "choisit la brique qu'il d√©sire utiliser:\n",
        "\n",
        "![](onyxia_ui1.png)\n",
        "\n",
        "Les *data scientists*\n",
        "et statisticiens n'ont donc pas besoin de conna√Ætre les d√©tails du fonctionnement des briques\n",
        "techniques d'`Onyxia` pour utiliser la plateforme. Les\n",
        "√©l√©ments techniques comme la connexion au syst√®me de stockage sont,\n",
        "par d√©faut, d√©j√† configur√©s :\n",
        "\n",
        "![](onyxia_ui2.png)\n",
        "\n",
        "L'interface ergonomique\n",
        "permet de param√©trer certaines configurations si besoin, notamment \n",
        "les ressources √† disposition du conteneur. N√©anmoins l'allocation\n",
        "dynamique des ressources offre d√©j√† de la flexibilit√© :\n",
        "\n",
        "![](onyxia_ui3.png)\n",
        "\n",
        "L'utilisateur a acc√®s √† l'ensemble des services qu'il a ouvert\n",
        "depuis une page d√©di√©e :\n",
        "\n",
        "![](onyxia_ui4.png)\n",
        "\n",
        "Les services interactifs comme `Jupyter`, `VSCode` ou `RStudio` permettent\n",
        "alors √† l'utilisateur d'acc√©der √† une interface pour ex√©cuter des \n",
        "traitements `Python` ou `R`. \n",
        "\n",
        "![](onyxia_ui5.png)\n",
        "\n",
        "L'acc√®s aux donn√©es peut se faire depuis la ligne de\n",
        "commande (via un utilitaire [Minio Client](https://min.io/docs/minio/linux/reference/minio-mc.html))\n",
        "ou par un package `Python` ou `R` d√©di√© qui permet de traiter\n",
        "le syst√®me de stockage distant comme un syst√®me local. Les\n",
        "traitements sont ex√©cut√©s sur les serveurs de la plateforme qui \n",
        "h√©berge les notebooks, ind√©pendamment de la machine par laquelle\n",
        "l'utilisateur acc√®de au service. Par exemple, dans le cas du `SSPCloud`,\n",
        "les traitements sont ex√©cut√©s depuis des serveurs h√©berg√©s √† l'Insee. \n",
        "\n",
        "## La communaut√© `Onyxia`\n",
        "\n",
        "Tous les composants sont propos√©s en _open source_ par l‚ÄôInsee ce qui permet de f√©d√©rer une communaut√©\n",
        "d'utilisateurs et de d√©veloppeurs de ce produit. \n",
        "Il s'agit d'un bel exemple de mutualisation au sein de l‚Äô√âtat et au del√†.\n",
        "Les d√©p√¥ts peuvent √™tre retrouv√©s sur\n",
        "le `Github` de l'√©quipe innovation (celui de [l'interface web](https://github.com/InseeFrLab/onyxia-web),\n",
        "celui des [images pour la data-science](https://github.com/InseeFrLab/images-datascience)...).\n",
        "La communaut√© peut proposer de nouveaux services dans le catalogue.\n",
        "\n",
        "Cette approche _bottom up_ a d√©j√† permis \n",
        "d'adapter des services aux besoins des utilisateurs ou d'am√©liorer la solution gr√¢ce √† des retours\n",
        "des r√©-utilisateurs d'`Onyxia`. \n",
        "\n",
        "<!-----\n",
        "<iframe width=\"100%\" height=\"500px\" marginheight=\"0\" marginwidth=\"0\" src=\"./template/index.html\">\n",
        "Fallback text here for unsupporting browsers, of which there are scant few.\n",
        "</iframe>\n",
        "----->\n",
        "\n",
        "## Les plateformes bas√©es sur Onyxia\n",
        "\n",
        "La plateforme d'origine, le `SSPCloud`,\n",
        "est ouverte √† tous les agents de l‚Äô√âtat et √† plusieurs √©coles.\n",
        "Celle-ci est exclusivement limit√©e √† l‚Äôexploitation de donn√©es _open data_.\n",
        "Cette strat√©gie d‚Äôoffreur de services de traitement sur l‚Äôopen data permet de montrer\n",
        "l‚Äôexpertise de l‚ÄôInsee sur les sujets _data science_.\n",
        "\n",
        "Les principaux usages de cette plateforme sont les suivants :\n",
        "\n",
        "* la formation ;\n",
        "* l‚Äôorganisation de hackathons ;\n",
        "* la mise √† disposition de services innovants et visualisations utilisant de l'open data ;\n",
        "\n",
        "Gr√¢ce √† la mise √† disposition de la solution `Onyxia` sur `Github`,\n",
        "il est n√©anmoins possible d'adapter cette plateforme pour des _datalab_ internes, sur donn√©es plus sensibles.\n",
        "\n",
        "L‚ÄôInsee n‚Äôest donc d√©sormais plus seul et f√©d√®re de nombreux acteurs autour de son projet.\n",
        "Fin 2021, `Eurostat` a √©t√© la premi√®re organisation en dehors\n",
        "de l‚ÄôInsee √† choisir `Onyxia` pour construire son [_Cloud Agnostic Data Lab_](https://github.com/eurostat/datalab).\n",
        "Expertise France pour le projet `DATAFID` a fait le choix d‚ÄôOnyxia tout comme le CASD,\n",
        "le GENES ou encore le _BercyHub_ avec le projet `Nubonyxia`.\n",
        "\n",
        "D‚Äôautres organisations sont plus dans une phase de POC ou d‚Äô√©tude : l‚ÄôINS norv√©gien, Pole Emploi, Data4Good,\n",
        "le minist√®re de l‚ÄôInt√©rieur, le minist√®re de la Justice, l‚ÄôInria...\n",
        "\n",
        "Dans le cadre du [TOSIT](https://tosit.fr/), association qui r√©unit de gros acteurs publics et priv√©s autour de solutions\n",
        "_open source_, un certain nombre d'entreprises s'int√©ressent √† `Onyxia`. \n",
        "\n",
        "## Vid√©o de pr√©sentation d'`Onyxia`\n",
        "\n",
        "{{< youtube zwKiO6LcIWE >}}\n",
        "\n",
        "{{< video https://youtu.be/zwKiO6LcIWE >}}\n",
        "\n",
        "## R√©f√©rences\n",
        "\n",
        "::: {#refs}\n",
        ":::\n"
      ],
      "id": "f64ee7a2"
    }
  ],
  "metadata": {
    "kernelspec": {
      "name": "python3",
      "language": "python",
      "display_name": "Python 3 (ipykernel)",
      "path": "/opt/python/share/jupyter/kernels/python3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 5
}