<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<link rel="alternate" hreflang="fr" href="https://InseeFrLab.github.io/ssphub/pr-preview/pr-115/infolettre/infolettre_15/index.html" />
<link rel="alternate" hreflang="en" href="https://InseeFrLab.github.io/ssphub/pr-preview/pr-115/en/infolettre/infolettre_15/index.en.html" />
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Infolettre de rentr√©e, Septembre 2023">

<title>Co√ªts d‚Äôentr√©e trop √©lev√©s pour l‚Äôentra√Ænement des mod√®les de langage qui s‚Äôorientent vers l‚Äôopensource ; LlaMaA et Falcon les nouveaux LLM ‚Äì SSPHub</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-fe39306e42976778068152c2bf72bcac.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Pas de r√©sultats",
    "search-matching-documents-text": "documents trouv√©s",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: white;
      }

      .quarto-title-block .quarto-title-banner {
        color: white;
background: #6886bb;
      }
</style>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">SSPHub</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Recherche"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Basculer la navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Accueil</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../event.html"> 
<span class="menu-text">√âv√©nements</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../project.html"> 
<span class="menu-text">Projets</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../course.html"> 
<span class="menu-text">Ressources utiles</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-propos" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">√Ä propos</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-propos">    
        <li>
    <a class="dropdown-item" href="../../infolettre/infolettre.html">
 <span class="dropdown-text">Newsletters</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../about.html">
 <span class="dropdown-text">Pr√©sentation du r√©seau</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../additional/manifeste.html">
 <span class="dropdown-text">Manifeste du r√©seau</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://datalab.sspcloud.fr/"> 
<span class="menu-text">Le SSPCloud</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/InseeFrLab/ssphub"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <div id="quarto-announcement" data-announcement-id="d14fcd9fc2e806dcc24e12ea5d639735" class="alert alert-primary hidden"><i class="bi bi-bi-megaphone quarto-announcement-icon"></i><div class="quarto-announcement-content">
<p>üì∫Ô∏è Le replay des ateliers du <strong>9 et 16 avril 2025</strong> sont disponibles <a href="../../event/2025-04-09-API/index.html">ici (API)</a> et <a href="../../event/2025-04-16-Parquet/index.html">ici (pour le format Parquet)</a></p>
</div><i class="bi bi-x-lg quarto-announcement-action"></i></div>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Co√ªts d‚Äôentr√©e trop √©lev√©s pour l‚Äôentra√Ænement des mod√®les de langage qui s‚Äôorientent vers l‚Äôopensource ; LlaMaA et Falcon les nouveaux LLM</h1>
                  <div>
        <div class="description">
          <p>Infolettre de rentr√©e, <strong>Septembre 2023</strong></p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Infolettre</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Auteur¬∑rice</div>
      <div class="quarto-title-meta-contents">
               <p>Lino Galiana </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Date de publication</div>
      <div class="quarto-title-meta-contents">
        <p class="date">10 septembre 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sur cette page</h2>
   
  <ul>
  <li><a href="#enjeux-associ√©s-au-r√©entrainement-des-mod√®les-de-langage" id="toc-enjeux-associ√©s-au-r√©entrainement-des-mod√®les-de-langage" class="nav-link active" data-scroll-target="#enjeux-associ√©s-au-r√©entrainement-des-mod√®les-de-langage">Enjeux associ√©s au r√©entrainement des mod√®les de langage</a>
  <ul class="collapse">
  <li><a href="#un-entra√Ænement-ex-nihilo-hors-de-port√©e" id="toc-un-entra√Ænement-ex-nihilo-hors-de-port√©e" class="nav-link" data-scroll-target="#un-entra√Ænement-ex-nihilo-hors-de-port√©e">Un entra√Ænement <em>ex nihilo</em> hors de port√©e</a></li>
  <li><a href="#la-r√©utilisation-en-pratique" id="toc-la-r√©utilisation-en-pratique" class="nav-link" data-scroll-target="#la-r√©utilisation-en-pratique">La r√©utilisation en pratique</a></li>
  </ul></li>
  <li><a href="#actualit√©s-des-mod√®les-de-langage" id="toc-actualit√©s-des-mod√®les-de-langage" class="nav-link" data-scroll-target="#actualit√©s-des-mod√®les-de-langage">Actualit√©s des mod√®les de langage</a>
  <ul class="collapse">
  <li><a href="#de-nouveaux-grands-mod√®les-de-langage-llm" id="toc-de-nouveaux-grands-mod√®les-de-langage-llm" class="nav-link" data-scroll-target="#de-nouveaux-grands-mod√®les-de-langage-llm">De nouveaux grands mod√®les de langage (LLM)</a></li>
  <li><a href="#le-r√©entrainement-des-mod√®les" id="toc-le-r√©entrainement-des-mod√®les" class="nav-link" data-scroll-target="#le-r√©entrainement-des-mod√®les">Le r√©entrainement des mod√®les</a></li>
  </ul></li>
  <li><a href="#le-reste-de-lactualit√©" id="toc-le-reste-de-lactualit√©" class="nav-link" data-scroll-target="#le-reste-de-lactualit√©">Le reste de l‚Äôactualit√©</a></li>
  <li><a href="#√©v√©nements" id="toc-√©v√©nements" class="nav-link" data-scroll-target="#√©v√©nements">√âv√©nements</a>
  <ul class="collapse">
  <li><a href="#mc-datascientest" id="toc-mc-datascientest" class="nav-link" data-scroll-target="#mc-datascientest">Masterclass <em>datascientest</em> sur le <em>fine-tuning</em></a></li>
  <li><a href="#autres-√©v√©nements" id="toc-autres-√©v√©nements" class="nav-link" data-scroll-target="#autres-√©v√©nements">Autres √©v√©nements</a></li>
  <li><a href="#rejoindre-le-salon-tchap-ssp-hub" id="toc-rejoindre-le-salon-tchap-ssp-hub" class="nav-link" data-scroll-target="#rejoindre-le-salon-tchap-ssp-hub">Rejoindre le salon Tchap <code>SSP Hub</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="learning.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Astuce
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong><em>Vous d√©sirez int√©grer la liste de diffusion ? L‚Äôinscription se fait <a href="https://grist.numerique.gouv.fr/o/ssphub/forms/jSjAV3L2F8mmiRVuVEpfF7/103">ici</a>.</em></strong></p>
</div>
</div>
<p>C‚Äôest la rentr√©e ! Comme les √©l√®ves qui reviennent sur les bancs des √©coles, les mod√®les de <em>machine learning</em> ont p√©riodiquement besoin de mettre √† jour leurs connaissances.</p>
<p>Cette <em>newsletter</em> sera consacr√©e aux enjeux du r√©-entrainement et de la sp√©cialisation de mod√®les, une question d‚Äôactualit√© suite √† la publication estivale de plusieurs grands mod√®les de langage (LLM) <em>open source</em>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>La premi√®re partie de cette <em>newsletter</em> se concentrera sur les enjeux principaux. La suite sera plus technique et √©voquera plus en d√©tail certains mod√®les et les m√©thodes de r√©-entrainement.</p>
</div>
</div>
<section id="enjeux-associ√©s-au-r√©entrainement-des-mod√®les-de-langage" class="level1">
<h1>Enjeux associ√©s au r√©entrainement des mod√®les de langage</h1>
<section id="un-entra√Ænement-ex-nihilo-hors-de-port√©e" class="level2">
<h2 class="anchored" data-anchor-id="un-entra√Ænement-ex-nihilo-hors-de-port√©e">Un entra√Ænement <em>ex nihilo</em> hors de port√©e</h2>
<p>Si de nombreuses t√¢ches de mod√©lisation ne n√©cessitent pas des mod√®les tr√®s sophistiqu√©s, deux domaines de recherche - √† savoir le traitement naturel du langage (NLP) et l‚Äôanalyse d‚Äôimage - ont connu ces derni√®res ann√©es des innovations importantes gr√¢ce √† des <a href="https://www.cnil.fr/fr/definition/reseau-de-neurones-artificiels-artificial-neural-network">r√©seaux de neurones</a> √† l‚Äôarchitecture de plus en plus complexe.</p>
<p>Pour √™tre en mesure d‚Äôentra√Æner un mod√®le complexe, du type <a href="https://fr.wikipedia.org/wiki/Grand_mod%C3%A8le_de_langage">grand mod√®le de langage (LLM)</a>, il faut, <em>a minima</em>, disposer des intrants suivants:</p>
<ul>
<li>Un <strong>immense volume de donn√©es d√©structur√©es</strong>. La constitution de ces corpus implique le moissonnage en masse de ressources en ligne, ce qui n‚Äôest pas sans poser des <a href="https://www.deeplearning.ai/the-batch/time-to-update-copyright-for-generative-ai/">enjeux juridiques de propri√©t√© intellectuelle</a> qui ne sont pas encore r√©solus. La r√©cup√©ration de ces donn√©es n√©cessite une bonne connaissance de la structure et la nature des donn√©es n√©cessaires pour entrainer un mod√®le ;</li>
<li>Des <strong>ressources informatiques hors du commun</strong>. Les investissements importants pour les cartes graphiques (GPU), une <a href="https://www.nytimes.com/2023/08/16/technology/ai-gpu-chips-shortage.html">mati√®re premi√®re en p√©nurie</a> et les co√ªts courants associ√©s (√©lectricit√©, maintenance‚Ä¶) font qu‚Äôune poign√©e d‚Äôacteurs du num√©rique disposent des moyens financiers ad√©quats pour entra√Æner un mod√®le <em>ex nihilo</em>. Cet article de <a href="https://www.forbes.com/sites/craigsmith/2023/09/08/what-large-models-cost-you--there-is-no-free-ai-lunch/">Forbes</a> √©voque des montants de l‚Äôordre de plusieurs dizaines voire centaines de millions de dollars.</li>
<li>Des <strong>experts</strong> aux comp√©tences √† l‚Äôintersection entre la recherche en math√©matique et informatique ainsi que des sp√©cialistes en <em>data engineering</em> actuellement en p√©nurie sur le march√© du travail.</li>
</ul>
<p>La combinaison de ces facteurs rend difficile, si ce n‚Äôest impossible, l‚Äôentrainement <em>ex nihilo</em> de tels mod√®les par la majorit√© des acteurs de la donn√©e. Seule une poign√©e de centres de recherche diposent des ressources permettant d‚Äôentra√Æner <em>ex nihilo</em> ce type de mod√®les.</p>
</section>
<section id="la-r√©utilisation-en-pratique" class="level2">
<h2 class="anchored" data-anchor-id="la-r√©utilisation-en-pratique">La r√©utilisation en pratique</h2>
<p>N√©anmoins, les besoins d‚Äôutilisation de ces mod√®les d√©passent le cercle des acteurs en mesure de les entra√Æner. En effet, les grands mod√®les de langage sont g√©n√©ralement entra√Æn√©s sur des corpus g√©n√©riques de langage naturel principalement issus d‚Äôinternet (<a href="#tbl-corpus-falcon" class="quarto-xref">Table&nbsp;1</a>). Cela les rend capables de comprendre les interactions avec des utilisateurs, notamment leurs instructions (<em>prompt</em>) et d‚Äôinteragir avec eux de mani√®re assez naturelle.</p>
<p>N√©anmoins, pour des t√¢ches tr√®s sp√©cialis√©es ou alors face √† des corpus particuliers, ces mod√®les g√©n√©riques peuvent n√©cessiter d‚Äô√™tre sp√©cialis√©s pour obtenir de meilleures performances. Plusieurs types de techniques, de <a href="https://www.deeplearning.ai/the-batch/tips-for-taking-advantage-of-open-large-language-models/">complexit√© graduelle</a>, ont ainsi √©merg√© pour √™tre en mesure de r√©utiliser et am√©liorer un mod√®le pr√©-entra√Æn√©.</p>
<p>Un frein √† la r√©utilisation massive de mod√®les pr√©-entra√Æn√©s est la nature propri√©taire de certains mod√®les, dont les conditions de r√©utilisation peuvent √™tre limitantes. Pour cette raison, l‚Äô√©mergence de mod√®les <em>open source</em>, dont la structure est plus transparente et dont les conditions de r√©utilisation sur des infrastructures internes sont moins restrictives, est devenu ces derniers mois un enjeu important dans l‚Äô√©cosyst√®me de la donn√©e.</p>
<p>Les discussions sur l‚Äôouverture des mod√®les s‚Äôinscrivent dans le contexte d‚Äôun affrontement important entre deux visions du mod√®le √©conomique du secteur num√©rique : si le co-cr√©ateur d‚Äô<code>OpenAI</code> a pu affirmer, pour justifier l‚Äôabsence de transparence scientifique sur les mod√®les d‚Äô<code>OpenAI</code> <a href="https://www.theverge.com/2023/3/15/23640180/openai-gpt-4-launch-closed-research-ilya-sutskever-interview">‚Äú<em>[on openly sharing research,] we were wrong</em>‚Äù</a>, un <a href="https://www.theverge.com/2023/7/10/23790132/google-memo-moat-ai-leak-demis-hassabis">m√©mo interne de Google</a> d√©fendait quant √† lui l‚Äôid√©e que les mod√®les <em>open source</em> sont amen√©s √† prendre le dessus, car ils peuvent b√©n√©ficier √† plus grande √©chelle du travail d‚Äôexperts et de retours d‚Äôutilisateurs.</p>
<p>La publication cet √©t√© de deux mod√®les <em>open source</em> (<a href="https://ai.meta.com/llama/"><code>LLaMA-2</code></a> par Meta et <a href="https://falconllm.tii.ae/"><code>Falcon</code></a> par l‚ÄôInstitut de l‚Äôinnovation technologique d‚ÄôAbu Dhabi) ouvre de nouvelles perspectives pour une r√©utilisation de mod√®les dans une infrastructure interne, √† condition de disposer des ressources computationnelles suffisantes et d‚Äôune strat√©gie adapt√©e de r√©-apprentissage.</p>
<p>Pour aller plus loin sur ce sujet, la suite de cette <em>newsletter</em> √©voque des d√©tails plus techniques. La <em>masterclass</em> sur le sujet du <em>fine-tuning</em> que nous organisons avec <code>datascientest</code> (<a href="#mc-datascientest">plus d‚Äôinformations üëáÔ∏è</a>) permettra √©galement d‚Äôapprofondir cette question.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>D√©rouler pour en savoir plus sur le corpus d‚Äôentra√Ænement de <code>Falcon</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="tbl-corpus-falcon" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-corpus-falcon-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: <em><a href="https://huggingface.co/tiiuae/falcon-180B">Corpus d‚Äôentra√Ænement de Falcon 180B</a></em>
</figcaption>
<div aria-describedby="tbl-corpus-falcon-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 47%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th>Source de donn√©es</th>
<th>Proportion dans le corpus</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>RefinedWeb-English</code> (<em>webscraping</em>)</td>
<td>75%</td>
</tr>
<tr class="even">
<td><code>RefinedWeb-Europe</code> (<em>webscraping</em>)</td>
<td>7%</td>
</tr>
<tr class="odd">
<td>Livres</td>
<td>6%</td>
</tr>
<tr class="even">
<td>Sites de conversations (<code>Reddit</code>, <code>StackOverflow</code>, <code>HackerNews</code>‚Ä¶)</td>
<td>5%</td>
</tr>
<tr class="odd">
<td>Code (<code>Github</code>‚Ä¶)</td>
<td>5%</td>
</tr>
<tr class="even">
<td>Documents techniques (<code>arXiv</code>, <code>PubMed</code>‚Ä¶)</td>
<td>2%</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="actualit√©s-des-mod√®les-de-langage" class="level1">
<h1>Actualit√©s des mod√®les de langage</h1>
<section id="de-nouveaux-grands-mod√®les-de-langage-llm" class="level2">
<h2 class="anchored" data-anchor-id="de-nouveaux-grands-mod√®les-de-langage-llm">De nouveaux grands mod√®les de langage (LLM)</h2>
<p>Pas de vacances pour les principaux acteurs de la <em>data science</em> ! Ce champ de recherche appliqu√©e continue √† conna√Ætre une actualit√© dense avec la publication, cet √©t√©, de deux mod√®les importants:</p>
<ul>
<li><a href="https://ai.meta.com/llama/"><code>LLaMA-2</code></a> par Meta, disponible en versions 7B, 13B et 70B c‚Äôest-√†-dire, respectivement, 7, 13 et 70 milliards de param√®tres. Dans le domaine des LLM actuels, c‚Äôest donc un mod√®le plut√¥t minimaliste (<code>GPT-3</code> comportait 175 milliards de param√®tres, <code>GPT-4</code> en comporterait 1.7 trillions soit 1700 milliards). Le site web <code>LeBonLLM</code> propose, d√©j√†, des exemples de <a href="https://www.lebonllm.fr/entrainer-son-llm-avec-llama-1-et-llama-2/"><em>fine tuning</em> de <code>LLaMa</code></a> ;</li>
<li><a href="https://falconllm.tii.ae/"><code>Falcon</code></a> par l‚ÄôInstitut d‚ÄôInnovation et de Technologie d‚ÄôAbu Dhabi. <a href="https://huggingface.co/tiiuae/falcon-40b">Falcon-40B</a> avait d√©j√† connu, cet √©t√©, un engouement important en se pla√ßant en t√™te des r√©utilisations sur <code>HuggingFace</code>. <a href="https://huggingface.co/tiiuae/falcon-180B">Falcon 180B</a>, sorti il y a quelques jours, rapproche les performances de celles des mod√®les propri√©taires.</li>
</ul>
<p>Ces deux mod√®les permettent d‚Äôenvisager des r√©utilisations apr√®s un r√©-entrainement sur des jeux de donn√©es <em>ad hoc</em> pour am√©liorer leurs performances (technique du <em>fine tuning</em>). Ceci est possible gr√¢ce √† leurs licences permissives de r√©utilisation. Celle de <a href="https://falconllm.tii.ae/"><code>Falcon</code></a> est assez standard puisqu‚Äôil s‚Äôagit d‚Äôune <a href="https://fr.wikipedia.org/wiki/Licence_Apache">Apache 2.0</a>. Celle de <a href="https://ai.meta.com/llama/"><code>LLaMA-2</code></a> est quant √† elle moins traditionnelle. La r√©utilisation est libre, y compris √† des fins commerciale, sauf pour les gros acteurs du num√©rique, globalement les concurrents de <code>Meta</code> :</p>
<blockquote class="blockquote">
<ol start="2" type="1">
<li>Additional Commercial Terms. If, on the Llama 2 version release date, the monthly active users of the products or services made available by or for Licensee, or Licensee‚Äôs affiliates, is greater than 700 million monthly active users in the preceding calendar month, you must request a license from Meta, which Meta may grant to you in its sole discretion, and you are not authorized to exercise any of the rights under this Agreement unless or until Meta otherwise expressly grants you such rights.</li>
</ol>
<p><a href="https://github.com/facebookresearch/llama/blob/d7e2e37e163981fd674ea2a633fac2014550898d/LICENSE#L65-L71">Licence de LLaMa-2 sur <code>Github</code></a></p>
</blockquote>
</section>
<section id="le-r√©entrainement-des-mod√®les" class="level2">
<h2 class="anchored" data-anchor-id="le-r√©entrainement-des-mod√®les">Le r√©entrainement des mod√®les</h2>
<p>L‚Äôouverture de ces mod√®les laisse envisager des r√©utilisations sur de nouveaux jeux de donn√©es dans des infrastructures internes. Cet √©t√©, <a href="https://www.deeplearning.ai/the-batch/tips-for-taking-advantage-of-open-large-language-models/">Andrew Ng</a>, dans sa <em>newsletter</em>, est revenu sur les m√©thodes pour affiner les performances d‚Äôun mod√®le sur des donn√©es qu‚Äôil n‚Äôa pas rencontr√©es dans son corpus d‚Äôentra√Ænement.</p>
<ul>
<li>La technique la plus simple est d‚Äô<strong>affiner les instructions</strong> (<em>prompt</em>) fournies √† un mod√®le. Pour faire l‚Äôanalogie avec l‚Äôapprentissage humain, pour obtenir une r√©ponse mieux cibl√©e √† une question, il est souvent n√©cessaire de reformuler une question. Par exemple, lors d‚Äôune interaction avec une IA assistante de code, il peut √™tre utile de guider un LLM avec une instruction <em>‚Äúas a data scientist‚Äù</em> ;</li>
<li><strong>Fournir quelques exemples √† un mod√®le</strong> (<em>few shot learning</em>). De m√™me qu‚Äôavec les humains, fournir un petit nombre d‚Äôexemples peut suffire √† un mod√®le, par un raisonnement inductif, √† comprendre et r√©pondre de mani√®re juste √† son instructeur. Selon la difficult√© de la t√¢che √† mettre en oeuvre, il peut suffire de tr√®s peu de cas pour sp√©cialiser un mod√®le en modifiant les derni√®res couches du r√©seau de neurone.</li>
<li><strong>Fournir de nouvelles sources √† un mod√®le avant de l‚Äôinterroger</strong> (<em>retrieval augmented generation</em>). Cette technique consiste √† enrichir la base de connaissance d‚Äôun mod√®le pr√©-entra√Æn√© avec un nouveau corpus puis l‚Äôinterroger sur la m√™me th√©matique afin, par exemple, d‚Äôobtenir une synth√®se ou alors une information contenue dans les documents mais n√©cessitant un temps d‚Äôextraction non n√©gligeable √† un humain. Dans cette approche, il ne s‚Äôagit pas de r√©entrainer le mod√®le pour mettre √† jour ses param√®tres mais de lui donner plus de contexte pour am√©liorer la pertinence des pr√©dictions ou r√©ponses du mod√®le. Pour continuer l‚Äôanalogie avec l‚Äôapprentissage humain, cette technique se rapproche d‚Äôune situation o√π un humain assimile une bibliographie pour rentrer dans un nouveau sujet.</li>
<li><strong>R√©entrainement par sp√©cialisation</strong> (<em>fine tuning</em>) pour affiner le mod√®le sur une t√¢che donn√©e. Il s‚Äôagit d‚Äôune approche qui peut ressembler √† l‚Äôapprentissage d‚Äôune nouvelle langue pour un humain: √† partir d‚Äôun certain stock de connaissances ant√©rieures (une langue natale), on accumule en s√©rie des exemples bien choisis pour am√©liorer la compr√©hension d‚Äôune autre langue. Cette approche permet une √©conomie de ressources puisqu‚Äôelle consiste √† sp√©cialiser un mod√®le g√©n√©raliste mais n√©cessite que la nature du probl√®me pour lequel est r√©-entrain√© un mod√®le ressemble √† celle pour lequel le mod√®le a √©t√© entra√Æn√©. De m√™me qu‚Äôessayer de transposer des r√®gles d‚Äôune langue latine aidera peu √† apprendre le japonais, sp√©cialiser un mod√®le d‚Äôanalyse d‚Äôimage pour une t√¢che de classification de donn√©es textuelles sera inefficace.</li>
</ul>
<p>Le <em>fine tuning</em> est ainsi une solution int√©ressante √† condition d‚Äôavoir test√© si des approches plus simples n‚Äôapportent pas d√©j√† des solutions satisfaisantes.</p>
<p>De plus, pour √™tre en mesure de <em>fine tuner</em> un mod√®le, outre l‚Äôacc√®s √† des ressources computationnelles cons√©quentes (mais tout de m√™me moindres qu‚Äôun entra√Ænement <em>ex nihilo</em>), beaucoup de m√©thodes n√©cessitent de disposer de donn√©es labellis√©es, c‚Äôest-√†-dire impliquent de poss√©der une base de donn√©es permettant de juger de la qualit√© des pr√©dictions du mod√®le. Pour pallier cette absence, il est possible de mettre en oeuvre un processus humain d‚Äôannotation et fournir au mod√®le ces √©valuations pour l‚Äôamener √† s‚Äôam√©liorer (technique nomm√©e <strong><em><a href="https://en.wikipedia.org/wiki/Reinforcement_learning_from_human_feedback">reinforcement learning from human feedback</a></em></strong>).</p>
<p>Comme l‚Äô√©voque encore Andrew Ng, l‚Äôacc√®s √† des mod√®les pr√©-entra√Æn√©s change le <a href="https://www.deeplearning.ai/the-batch/building-machine-learning-systems-is-more-debugging-than-development/">cycle de d√©veloppement des projets utilisateurs d‚ÄôIA</a>. Ces projets ne consistent plus, comme les logiciels classiques, √† d√©velopper en amont des sp√©cifications puis d√©ployer un mod√®le correspondant √† celles-ci mais, au contraire, √† commencer par mettre en oeuvre rapidement un premier mod√®le dont le comportement sera √©valu√© et am√©lior√© en continu par des m√©thodes comme l‚Äôapprentissage par renforcement.</p>
</section>
</section>
<section id="le-reste-de-lactualit√©" class="level1">
<h1>Le reste de l‚Äôactualit√©</h1>
<ul>
<li>La commission d‚Äôacc√®s aux documents administratifs (CADA) a rendu un <a href="https://www.cada.fr/20230314">avis</a> sur le sujet de la publication en <em>open source</em> des mod√®les d‚Äôapprentissage entra√Æn√©s par l‚Äôadministration fran√ßaise ;</li>
<li>Une association fran√ßaise a √©merg√© pour rassembler des ressources et offrir un espace communautaire autour des LLM francophones: <a href="https://www.lebonllm.fr/">Le Bon LLM</a> ;</li>
<li>La qualit√© des r√©ponses de <code>ChatGPT</code> pourrait s‚Äô√™tre <a href="https://www.deeplearning.ai/the-batch/chatgpts-behavior-change-over-time/">d√©grad√©e</a> au cours du temps ;</li>
<li>Le <em>Financial Times</em> pr√©sente de mani√®re tr√®s p√©dagogique le <a href="https://ig.ft.com/generative-ai/">fonctionnement des LLM</a> ;</li>
<li>Meta publie <a href="https://facebookresearch.github.io/nougat/"><code>Nougat</code></a>, un mod√®le tr√®s efficace de num√©risation de PDF ;</li>
<li>Le risque de disparition d‚Äôemplois d‚Äôacteurs et sc√©naristes du fait des IA g√©n√©ratrices est l‚Äôun des facteurs √† l‚Äôorigine de la gr√®ve √† Hollywood (<a href="https://www.lemonde.fr/economie/article/2023/07/14/greve-a-hollywood-les-acteurs-craignent-d-etre-remplaces-par-des-machines_6181893_3234.html">voir <em>Le Monde</em></a>) ;</li>
<li>Le mod√®le <em>open source</em> de g√©n√©ration d‚Äôimages <code>StableDiffusion</code> sort une <a href="https://stability.ai/stable-diffusion">version XL (<code>sdxl</code>)</a><br>
am√©liorant encore la qualit√© des productions (interface <a href="https://clipdrop.co/fr/stable-diffusion">ici</a>);</li>
<li>OpenAI int√®gre une nouvelle version de son g√©n√©rateur d‚Äôimage (<code>Dall-E 3</code>) dans <code>ChatGPT Plus</code> (<a href="https://openai.com/dall-e-3">annonce</a>) ;</li>
<li>La derni√®re revue de presse de la <a href="https://code.gouv.fr/fr/bluehats/bluehats_24/#revue-de-presse">Gazette BlueHats #24</a> recense de nombreux articles sur l‚ÄôIA ;</li>
<li>Un <a href="https://unehistoireduconflitpolitique.fr/">site interactif</a> riche de nombreuses data visualisations est associ√© au nouvel ouvrage de Thomas Piketty et Julia Cag√©, <em>Une histoire du conflit politique</em>.</li>
</ul>
</section>
<section id="√©v√©nements" class="level1">
<h1>√âv√©nements</h1>
<section id="mc-datascientest" class="level2">
<h2 class="anchored" data-anchor-id="mc-datascientest">Masterclass <em>datascientest</em> sur le <em>fine-tuning</em></h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../infolettre_11/datascientest.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:20.0%"></p>
</figure>
</div>
<p>Notre cycle de <em>masterclass</em> organis√©es en lien avec <em>datascientest</em> continue !</p>
<p>Apr√®s avoir explor√© en d√©tail les th√©matiques du traitement automatique du langage et de l‚Äôanalyse d‚Äôimage, nous progressons dans notre parcours avec le sujet du <em>fine tuning</em>.</p>
<p>Au programme:</p>
<ul>
<li>R√©utilisation de <em>transformers</em> (<code>BERT</code>) et de LLM (<code>LLaMA</code>) avec les librairies d‚Äô<code>HuggingFace</code> ;</li>
<li><em>Fine tuning</em> de ces mod√®les.</li>
</ul>
<p><strong>Rendez-vous le 6 octobre de 10h √† 12h</strong> ! <a href="https://framaforms.org/inscription-aux-masterclass-datascientest-1695194241">Inscription ici</a></p>
</section>
<section id="autres-√©v√©nements" class="level2">
<h2 class="anchored" data-anchor-id="autres-√©v√©nements">Autres √©v√©nements</h2>
<p>Quelques √©v√©nements ou informations int√©ressantes :</p>
<ul>
<li><a href="https://blog.velib-metropole.fr/hackathon/?utm_source=sendgrid.com&amp;utm_medium=email&amp;utm_campaign=website">Hackathon velib</a>, fermeture des inscriptions le 29 septembre ;</li>
<li><a href="https://unstats.un.org/bigdata/events/2023/un-datathon/">Hackathon de l‚ÄôONU</a>: fermeture des inscriptions √† la fin du mois ;</li>
<li><a href="https://mailings.isi-web.org/?na=v&amp;nk=15226-43b0d8c9de&amp;id=563">Prix du jeune statisticien de l‚ÄôIAOS</a> : article √† envoyer avant le 10 f√©vrier 2024.</li>
</ul>
<p>Les personnes int√©ress√©es par former une √©quipe pour les <em>hackathons</em> peuvent contacter <a href="mailto:contact-ssphub@insee.fr" class="email">contact-ssphub@insee.fr</a>.</p>
</section>
<section id="rejoindre-le-salon-tchap-ssp-hub" class="level2">
<h2 class="anchored" data-anchor-id="rejoindre-le-salon-tchap-ssp-hub">Rejoindre le salon Tchap <code>SSP Hub</code></h2>
<p>Pour √©changer autour des activit√©s du r√©seau et, plus largement, discuter entre pairs des sujets <em>data science</em>, il existe un <strong>salon <code>SSP Hub</code></strong> dans la messagerie s√©curis√©e de l‚Äô√âtat <code>Tchap</code>. Celui-ci r√©unit plus de 250 personnes et permet des √©changes plus directs, plus fr√©quents et plus informels que la liste de diffusion mail.</p>
<p>Si vous avez un compte sur <code>Tchap</code>, vous pouvez rejoindre ce salon en cherchant celui-ci par son nom <strong><code>¬´ SSP Hub ¬ª</code></strong>. En cas de probl√®me pour le rejoindre, n‚Äôh√©sitez pas √† envoyer un mail √† <a href="mailto:contact-ssphub@insee.fr" class="email">contact-ssphub@insee.fr</a>.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copi√©");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copi√©");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/InseeFrLab\.github\.io\/ssphub\/pr-preview\/pr-115\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>
