<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<link rel="alternate" hreflang="fr" href="https://user-nicolastlm-455756-0.user.lab.sspcloud.fr/proxy/4321/blog/onyxia/index.html" />
<link rel="alternate" hreflang="en" href="https://user-nicolastlm-455756-0.user.lab.sspcloud.fr/proxy/4321/en/blog/onyxia/index.en.html" />
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Les technologies cloud sont incontournables dans l‚Äô√©cosyst√®me de la donn√©e. Pour ne pas se rendre d√©pendante de fournisseurs de services externes, l‚ÄôInsee a d√©velopp√© un datalab avec des technologies √† la pointe pour ses data scientists. Le code source de celle-ci a √©t√© ouvert dans le cadre du projet Onyxia. Ce projet permet de f√©d√©rer une large communaut√© d‚Äôutilisateurs mais aussi d‚Äôorganisations int√©ress√©es par le d√©veloppement d‚Äôune plateforme souveraine de data science.">

<title>Onyxia: l‚Äôinfrastructure cloud m√®re des dragons ‚Äì SSPHub</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-fe39306e42976778068152c2bf72bcac.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Pas de r√©sultats",
    "search-matching-documents-text": "documents trouv√©s",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: white;
      }

      .quarto-title-block .quarto-title-banner {
        color: white;
background: #6886bb;
      }
</style>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">SSPHub</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Recherche"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Basculer la navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Accueil</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../event.html"> 
<span class="menu-text">√âv√©nements</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../project.html"> 
<span class="menu-text">Projets</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../course.html"> 
<span class="menu-text">Ressources utiles</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-propos" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">√Ä propos</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-propos">    
        <li>
    <a class="dropdown-item" href="../../infolettre/infolettre.html">
 <span class="dropdown-text">Newsletters</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../about.html">
 <span class="dropdown-text">Pr√©sentation du r√©seau</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../additional/manifeste.html">
 <span class="dropdown-text">Manifeste du r√©seau</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://datalab.sspcloud.fr/"> 
<span class="menu-text">Le SSPCloud</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/InseeFrLab/ssphub"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <div id="quarto-announcement" data-announcement-id="d14fcd9fc2e806dcc24e12ea5d639735" class="alert alert-primary hidden"><i class="bi bi-bi-megaphone quarto-announcement-icon"></i><div class="quarto-announcement-content">
<p>üì∫Ô∏è Le replay des ateliers du <strong>9 et 16 avril 2025</strong> sont disponibles <a href="../../event/2025-04-09-API/index.html">ici (API)</a> et <a href="../../event/2025-04-16-Parquet/index.html">ici (pour le format Parquet)</a></p>
</div><i class="bi bi-x-lg quarto-announcement-action"></i></div>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Onyxia: l‚Äôinfrastructure cloud m√®re des dragons</h1>
            <p class="subtitle lead">Un projet autour d‚Äôune infrastructure de data science √† la pointe</p>
                  <div>
        <div class="description">
          <p>Les technologies cloud sont incontournables dans l‚Äô√©cosyst√®me de la donn√©e. Pour ne pas se rendre d√©pendante de fournisseurs de services externes, l‚ÄôInsee a d√©velopp√© un datalab avec des technologies √† la pointe pour ses data scientists. Le code source de celle-ci a √©t√© ouvert dans le cadre du projet Onyxia. Ce projet permet de f√©d√©rer une large communaut√© d‚Äôutilisateurs mais aussi d‚Äôorganisations int√©ress√©es par le d√©veloppement d‚Äôune plateforme souveraine de data science.</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Insee</div>
                <div class="quarto-category">sspcloud</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Auteur¬∑rice</div>
      <div class="quarto-title-meta-contents">
               <p>Lino Galiana </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Date de publication</div>
      <div class="quarto-title-meta-contents">
        <p class="date">10 mai 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sur cette page</h2>
   
  <ul>
  <li><a href="#contexte" id="toc-contexte" class="nav-link active" data-scroll-target="#contexte">Contexte</a></li>
  <li><a href="#de-hdfs-√†-la-conteneurisation" id="toc-de-hdfs-√†-la-conteneurisation" class="nav-link" data-scroll-target="#de-hdfs-√†-la-conteneurisation">De HDFS √† la conteneurisation</a></li>
  <li><a href="#la-solution-onyxia" id="toc-la-solution-onyxia" class="nav-link" data-scroll-target="#la-solution-onyxia">La solution Onyxia</a>
  <ul class="collapse">
  <li><a href="#dun-cloud-de-ladministration-√†-un-logiciel-ouvert" id="toc-dun-cloud-de-ladministration-√†-un-logiciel-ouvert" class="nav-link" data-scroll-target="#dun-cloud-de-ladministration-√†-un-logiciel-ouvert">D‚Äôun <em>cloud</em> de l‚Äôadministration √† un logiciel ouvert</a></li>
  </ul></li>
  <li><a href="#onyxia-en-bref" id="toc-onyxia-en-bref" class="nav-link" data-scroll-target="#onyxia-en-bref">Onyxia en bref</a></li>
  <li><a href="#linterface-et-les-services-propos√©s-par-onyxia" id="toc-linterface-et-les-services-propos√©s-par-onyxia" class="nav-link" data-scroll-target="#linterface-et-les-services-propos√©s-par-onyxia">L‚Äôinterface et les services propos√©s par <code>Onyxia</code></a></li>
  <li><a href="#la-communaut√©-onyxia" id="toc-la-communaut√©-onyxia" class="nav-link" data-scroll-target="#la-communaut√©-onyxia">La communaut√© <code>Onyxia</code></a></li>
  <li><a href="#les-plateformes-bas√©es-sur-onyxia" id="toc-les-plateformes-bas√©es-sur-onyxia" class="nav-link" data-scroll-target="#les-plateformes-bas√©es-sur-onyxia">Les plateformes bas√©es sur Onyxia</a></li>
  <li><a href="#vid√©o-de-pr√©sentation-donyxia" id="toc-vid√©o-de-pr√©sentation-donyxia" class="nav-link" data-scroll-target="#vid√©o-de-pr√©sentation-donyxia">Vid√©o de pr√©sentation d‚Äô<code>Onyxia</code></a></li>
  <li><a href="#r√©f√©rences" id="toc-r√©f√©rences" class="nav-link" data-scroll-target="#r√©f√©rences">R√©f√©rences</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><code>Onyxia</code> est un logiciel <em>open source</em> d√©velopp√© par l‚ÄôInsee (<a href="https://github.com/InseeFrLab/onyxia-web">disponible sur <code>Github</code> <i class="fa-brands fa-github"></i></a>) permettant de fournir un environnement de traitement de donn√©es √† l‚Äô√©tat de l‚Äôart. Principalement con√ßu pour permettre le travail interactif des data scientists, l‚Äôexp√©rience fournie avec <code>Onyxia</code> favorise √©galement la reproductibilit√© des travaux et leur mise en production.</p>
<p>Le logiciel <code>Onyxia</code> est install√© par des organisations souhaitant cr√©er un <em>datalab</em>, c‚Äôest-√†-dire une plateforme interactive de traitement de donn√©es. Ces organisations ont toutes le point commun de vouloir construire une plateforme qui embrasse les technologies <em>cloud</em> que sont la conteneurisation et le stockage objet tout en mettant √† disposition celles-ci dans un environnement <em>user-friendly</em> o√π l‚Äôinterconnexion entre ces diff√©rentes briques est g√©r√©e de mani√®re coh√©rente. Les technologies <em>cloud native</em> sont devenues indispensables dans l‚Äô√©cosyst√®me de la donn√©e, du fait d‚Äôune meilleure gestion des ressources de traitement ou de la capacit√© √† cr√©er un environnement parfaitement reproductible pour une mise en production acc√©l√©r√©e.</p>
<p>Ce <em>post</em> de blog a pour objectif de pr√©senter la raison d‚Äô√™tre d‚Äô<code>Onyxia</code>, sa g√©n√®se et les solutions qu‚Äôapporte cette infrastructure √† des irritants classiques des projets novateurs de data science.</p>
<section id="contexte" class="level2">
<h2 class="anchored" data-anchor-id="contexte">Contexte</h2>
<p>L‚Äô√©cosyst√®me de la data science est en mouvement acc√©l√©r√© depuis 10 ans et le r√¥le du <em>data scientist</em> dans les organisations valorisant de la donn√©e √©volue continuellement <span class="citation" data-cites="davenport2022data">(<a href="#ref-davenport2022data" role="doc-biblioref">Davenport et Patil 2022</a>)</span>. Les data scientists modernes sont amen√©s √† utiliser de plus en plus de langages et doivent √™tre capables de ma√Ætriser plusieurs architectures informatiques. La fronti√®re est ainsi moins nette que par le pass√© entre statisticiens et informaticiens. De plus, les innovations r√©centes dans le monde du d√©veloppement logiciel, notamment l‚Äôadoption massive de l‚Äôapproche <code>DevOps</code> - approche qui consiste √† automatiser la production de livrables d√®s la conception du prototype - a √©galement fait √©voluer les pratiques des data scientists.</p>
<p>Ce besoin de ressources informatiques croissantes, de flexibilit√© dans le prototypage de solutions informatiques et l‚Äô√©volution des pratiques consistant √† mettre √† disposition en continu des livrables ont eu des implications importantes sur les architectures informatiques dominantes dans l‚Äô√©cosyst√®me de la donn√©e. Pour r√©pondre au besoin croissant de puissance de traitement, les serveurs partag√©s, organis√©s sous forme de <em>clusters</em>, se sont d√©velopp√©s dans de nombreuses organisations. Apr√®s avoir connue son heure de gloire au d√©but des ann√©es 2010, l‚Äôinfrastructure <a href="https://openclassrooms.com/fr/courses/4467481-creez-votre-data-lake/4509426-decouvrez-le-systeme-de-fichiers-distribue-hdfs"><code>HDFS</code> (<em>Hadoop Distributed File System</em>)</a>, qui reposait sur des <em>clusters</em> o√π les donn√©es et la puissance de traitement √©taient distribu√©es et collocalis√©es, a laiss√© place √† des infrastructures plus <em>scalables</em>, bas√©es sur l‚Äôapproche de la conteneurisation.</p>
</section>
<section id="de-hdfs-√†-la-conteneurisation" class="level2">
<h2 class="anchored" data-anchor-id="de-hdfs-√†-la-conteneurisation">De HDFS √† la conteneurisation</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Cette partie plus technique d√©veloppe des √©l√©ments pour comprendre le succ√®s r√©cent des infrastructures conteneuris√©es.</p>
<p>Elle pourra int√©resser le lecteur curieux sur les fondements des infrastructures <em>cloud</em> modernes mais n‚Äôest pas n√©cessaire √† la compr√©hension g√©n√©rale de l‚Äôarticle.</p>
</div>
</div>
<p>La conteneurisation, qui repose sur l‚Äôid√©e que les serveurs de stockage de la donn√©e peuvent √™tre dissoci√©s de ceux effectuant les traitements, sert de fondement aux principales plateformes <em>cloud</em> actuelles fournissant des services √† la demande.</p>
<p>Ce nouveau paradigme part de deux constats. Le premier est que les √©changes de donn√©es entre les noeuds d‚Äôun serveur sont aujourd‚Äôhui peu co√ªteux. Avec des flux r√©seaux suffisants et une technologie performante, il est donc possible d‚Äô√©changer √† un co√ªt mod√©r√© de gros volumes de donn√©es au sein d‚Äôune infrastructure. Le deuxi√®me constat est que la maintenance d‚Äôune infrastructure conteneuris√©e, faite pour √™tre tr√®s mall√©able, est plus l√©g√®re que celle d‚Äôune infrastructure bas√©e sur des machines virtuelles ou sur les infrastructrures calibr√©es pour l‚Äôanalytique <em>big data</em> comme <code>HDFS</code> reposant sur la collocalisation des donn√©es et des traitements<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<p>Les donn√©es √©tant stock√©es sur des serveurs diff√©rents de ceux ex√©cutant les traitements, l‚Äôacc√®s √† celles-ci se fait √† travers des API qui permettent de traiter le syst√®me de stockage distant comme un syst√®me de fichiers classique. <code>Onyxia</code> a adopt√© une impl√©mentation <em>open source</em> du syst√®me de stockage <a href="https://fr.wikipedia.org/wiki/Amazon_S3"><code>S3</code></a> appel√©e <a href="https://min.io/"><code>MinIO</code></a>.</p>
<p>En ce qui concerne le traitement des donn√©es, le fait d‚Äôutiliser un syst√®me de conteneurs, c‚Äôest-√†-dire une configuration logicielle portable minimaliste pr√™te √† l‚Äôemploi (par opposition aux machines virtuelles qui impliquent un syst√®me d‚Äôexploitation complet), offre une grande libert√© sur le choix des logiciels de traitement. De nombreuses technologies <em>open source</em> devenues standards dans le monde de la <em>data science</em> (<code>Jupyter</code>, <code>RStudio</code>, <code>ElasticSearch</code>‚Ä¶) existent d√©j√† sous cette forme et peuvent ainsi √™tre adopt√©es dans une telle infrastructure pour fournir des services pr√™ts-√†-l‚Äôemploi pour les data scientists. La mise en musique de toutes ces petites boites auto-suffisantes, notamment l‚Äôoptimisation des ressources concurrentes sur un serveur, est permise par la technologie d‚Äôorchestration <a href="https://kubernetes.io/fr/"><code>Kubernetes</code></a>.</p>
<p><br></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption><em>Centralisation des ressources par <code>Onyxia</code></em></figcaption>
<p><img src="onyxia_logic.svg" class="img-fluid figure-img"></p>
</figure>
</div>
<p><br></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Plus de d√©tails pour comprendre le changement de paradigme vers la conteuneurisation üëá
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Les infrastructures <em>big data</em> reposent sur le principe du <em>cluster</em> (grappe) informatique. Des serveurs sont connect√©s entre eux, ce qui forme de mani√®re imag√©e une grappe. Cette interconnexion de plusieurs serveurs entre eux peut se faire au niveau :</p>
<ul>
<li>du <strong>stockage</strong> : les donn√©es volumineuses ne sont pas stock√©es sur un seul serveur mais au contraire r√©parties ;</li>
<li>du <strong>traitement</strong> : les calculs sont effectu√©s par blocs sur plusieurs serveurs et le r√©sultat de ceux-ci est ensuite transmis √† un serveur ma√Ætre.</li>
</ul>
<p>Le syst√®me <em>Hadoop Distributed File System</em> a √©t√© pens√© pour tirer parti de l‚Äôalgorithme de traitement parall√©lis√© <a href="https://fr.wikipedia.org/wiki/MapReduce"><code>MapReduce</code></a> propos√© en 2004 par <code>Google</code>. Les fichiers volumineux sont fractionn√©s et r√©partis sur plusieurs serveurs.</p>
<p><img src="https://i0.wp.com/datascientest.com/wp-content/uploads/2021/04/illu_schema_mapreduce-04.png?w=1024&amp;ssl=1" class="img-fluid"></p>
<p><em>Fonctionnement d‚Äôune architecture <code>MapReduce</code> (source: <a href="https://datascientest.com/mapreduce">Datascientest</a>)</em></p>
<p>La sp√©cificit√© de l‚Äôarchitecture <code>HDFS</code> est que non seulement le stockage est distribu√© mais √©galement aussi la puissance de traitement associ√©e. On parle √† ce propos de <strong>collocalisation</strong> : les traitements ont lieu sur les m√™mes serveurs que ceux o√π sont stock√©s les donn√©es. Cela permet de r√©duire les mouvements de donn√©es (<em>shuffle</em> dans l‚Äôimage ci-dessus) qui sont co√ªteux du point de vue de la performance. Cette collocalisation a permis au syst√®me <code>HDFS</code> de devenir, au d√©but de la d√©cennie 2010, le paradigme dominant. En tirant parti de la parall√©lisation permise par des langages tr√®s efficaces comme <code>Spark</code> tout en limitant les √©changes r√©seaux pouvant faire perdre en performance, cette architecture a attir√© au-del√† de l‚Äô√©cosyst√®me du <em>big data</em>.</p>
<p>Le syst√®me HDFS pr√©sente n√©anmoins certaines limites qui expliquent sa perte de succ√®s avec l‚Äô√©mergence d‚Äôun nouveau paradigme plus flexible.</p>
<p>En premier lieu, ce syst√®me n√©cessite beaucoup de ressources du fait de son <em>design</em>. Comme les traitements sont lourds et partag√©s pour des usages concurrents, les noeuds constituant le <em>cluster</em> peuvent subir des arr√™ts √† cause de surcharge des ressources. Pour tenir compte de la nature instable de cette infrastructure <em>big data</em>, les fichiers sont dupliqu√©s. Ainsi, lors d‚Äôune erreur sur le serveur g√©n√©rant un arr√™t du n≈ìud (par exemple √† cause de traitements trop gourmands), les traitements sur l‚Äôensemble des donn√©es sont s√©curis√©s √©vitant √©galement la perte partielle ou totale de ces derni√®res.</p>
<p>L‚Äôimplication est que les donn√©es, d√©j√† volumineuses, sont dupliqu√©es plusieurs fois impliquant des architectures assez monumentales. Si la duplication de la donn√©e n‚Äôest pas en soi choquante afin d‚Äô√©viter la perte de donn√©es, cela a un effet pervers dans un syst√®me de collocalisation. A chaque ajout de noeuds pour le stockage de donn√©es, il est √©galement n√©cessaire d‚Äôajouter des ressources pour les traiter. Il est donc compliqu√© de d√©corr√©ler l‚Äôajout de ressources de stockage et de traitement. Cette absence de flexibilit√© est p√©nalisante dans un monde o√π les donn√©es sont mises √† jour fr√©quemment et o√π les technologies de traitement, donc les besoins associ√©s, √©voluent rapidement. Les infrastructures <code>HDFS</code> sont donc lourdes √† changer, que ce soit pour ajouter des ressources ou faire √©voluer les distributions logicielles pr√©sentes dessus.</p>
<p>Le deuxi√®me facteur qui a favoris√© le changement de paradigme est l‚Äôam√©lioration des √©changes r√©seaux. Il n‚Äôest plus aussi co√ªteux que par le pass√© de transf√©rer des volumes importants de donn√©es au sein d‚Äôune infrastructure. Cela facilite la d√©corr√©lation entre environnement de stockage et de traitement.</p>
<p>Cette s√©paration des environnements de stockage et de traitement permet alors d‚Äôadopter pour chacun les technologies les plus performantes. Dans le domaine du stockage, celle qui a rencontr√© le plus de succ√®s est le syst√®me de stockage <a href="https://aws.amazon.com/fr/s3/"><code>S3</code></a> d√©velopp√© par Amazon. L‚Äôimpl√©mentation <em>open source</em> du syst√®me S3 est <a href="https://min.io/"><code>MinIO</code></a>, utilis√©e par <code>Onyxia</code>.</p>
<p>Dans le domaine du traitement, la technologie la plus performante d√©pend de la nature de la t√¢che r√©alis√©e. Selon qu‚Äôon d√©sire effectuer de la recherche textuelle, des visualisations de donn√©es ou de l‚Äôanalyse d‚Äôimage, on ne va pas vouloir utiliser la m√™me technologie. Pour mettre √† disposition des logiciels sur un serveur, il existe principalement deux approches concurrentes.</p>
<p>La premi√®re repose sur le principe des machines virtuelles. Cette approche n‚Äôest pas nouvelle et de nombreuses organisations ont propos√© ou proposent encore ce type d‚Äôinfrastructures pour des serveurs collectifs de traitement. Cette approche est n√©anmoins lourde : elle n√©cessite un syst√®me d‚Äôexploitation complet dont il faudra ensuite adapter la configuration lors de l‚Äôinstallation de chaque logiciel. Plusieurs logiciels coexistent donc dans ce syst√®me d‚Äôexploitation m√™me si un seul, par exemple, <code>Python</code>, est utilis√©. Les machines virtuelles sont des infrastructures assez polluantes puisque pour faire fonctionner un syst√®me d‚Äôexploitation dans son ensemble, il est n√©cessaire de mobiliser des ressources plus importantes que celles seulement n√©cessaires aux traitements. De plus, la configuration d‚Äôun syst√®me d‚Äôexploitation, et notamment, la gestion de la d√©pendance de multiples logiciels √† des configurations syst√®mes qui peuvent ne pas correspondre, n‚Äôest pas triviale. Il est donc lourd de faire √©voluer une infrastructure reposant sur des machines virtuelles. L‚Äôabsence de flexibilit√© d‚Äôune infrastructure reposant sur le principe des machines virtuelles est p√©nalisante dans un √©cosyst√®me mouvant comme celui de la <em>data science</em>, o√π une partie importante du travail de prototypage consiste √† tester plusieurs technologies pour d√©terminer celle s‚Äôint√©grant le mieux dans un processus de traitement de donn√©es.</p>
<p>Le syst√®me de la conteneurisation a justement √©t√© pens√© pour cela : plut√¥t qu‚Äôinstaller de nombreuses librairies au niveau du syst√®me, pour une fraction d‚Äôutilisateurs limit√©e √† chacune, il est plus int√©ressant de cr√©er des environnements complets qui vont exister de mani√®re conjointe. Chaque <em>framework</em> va √™tre construit comme un conteneur autosuffisant avec un syst√®me d‚Äôexploitation minime et un nombre minimal de couches de configurations suppl√©mentaires. Un <em>framework</em> est livr√© sous la forme d‚Äôune image <a href="https://fr.wikipedia.org/wiki/Docker_(logiciel)"><code>Docker</code></a>, une technologie qui permet d‚Äôempaqueter un logiciel et ses d√©pendances sous la forme de boites minimalistes et les mettre √† disposition facilement pour une r√©utilisation. Il existe par exemple des images <code>Docker</code> pour pouvoir utiliser <code>RStudio</code>, <code>Jupyter</code>, <code>VSCode</code> avec des configurations minimales afin d‚Äôex√©cuter du <code>Python</code> ou du <code>R</code>. A partir de celles-ci, l‚Äôutilisateur qui d√©sire des configurations suppl√©mentaires peut ajouter les couches qui lui sont utiles.</p>
<p>Mais les images <code>Docker</code> ne se r√©duisent pas √† la mise √† disposition d‚Äôenvironnements de d√©veloppement. Une partie des technologies les plus appr√©ci√©es de l‚Äô√©cosyst√®me de la data science sont √©galement livr√©es sous forme d‚Äôimages <code>Docker</code>. Par exemple, le moteur de recherche <code>ElasticSearch</code>, tr√®s utilis√© pour la recherche textuelle, peut √™tre empaquet√© dans une image <code>Docker</code>. Le logiciel <code>Onyxia</code> propose d√®s lors, dans un catalogue vivant, un certain nombre de logiciels tr√®s utiles pour les <em>data scientists</em> ayant fait l‚Äôobjet d‚Äôun tel empaquetage. Les nombreuses images <code>Docker</code> servant √† cr√©er des services pour les <em>data scientists</em> sont disponibles en <em>open source</em> sur <a href="https://github.com/InseeFrLab/images-datascience"><code>Github</code></a>.</p>
<p>Pour organiser sur un serveur la coexistence de multiples utilisateurs de services gourmands en ressource, la solution <a href="https://kubernetes.io/fr/"><code>Kubernetes</code></a> fait aujourd‚Äôhui office de r√©f√©rence. Entre sa cr√©ation en 2014 et aujourd‚Äôhui, cette solution d‚Äôorchestration, c‚Äôest-√†-dire de gestion d‚Äôune infrastructure, est devenue incontournable. Outre son allocation dynamique des ressources, elle permet de transformer facilement le livrable d‚Äôune chaine de traitement en application disponible en continu. Ceci est particuli√®rement adapt√© dans un contexte de diversification des livrables fournis par les <em>data scientists</em> (API, application web, mod√®le‚Ä¶) et d‚Äôadoption d‚Äôune d√©marche <code>DevOps</code> voire <code>MLOps</code>.</p>
</div>
</div>
</div>
</section>
<section id="la-solution-onyxia" class="level2">
<h2 class="anchored" data-anchor-id="la-solution-onyxia">La solution Onyxia</h2>
<section id="dun-cloud-de-ladministration-√†-un-logiciel-ouvert" class="level3">
<h3 class="anchored" data-anchor-id="dun-cloud-de-ladministration-√†-un-logiciel-ouvert">D‚Äôun <em>cloud</em> de l‚Äôadministration √† un logiciel ouvert</h3>
<p>Pour permettre aux <em>data scientists</em> des administrations fran√ßaises de b√©n√©ficier de technologies <em>cloud</em> sans √™tre d√©pendant d‚Äôun fournisseur de service priv√©, l‚Äô√©quipe innovation de l‚ÄôInsee a eu l‚Äôid√©e de cr√©er un <em>datalab</em> bas√© sur la philosophie de la conteneurisation en mobilisant exclusivement des composants open-source.</p>
<p>Ce <em>datalab</em>, n√© √† l‚ÄôInsee en 2018, a √©t√© ouvert √† l‚Äôadministration publique sous la forme d‚Äôune instance https://www.sspcloud.fr/ √† condition d‚Äôutiliser des donn√©es ouvertes. En plus des agents d√©j√† en poste dans l‚Äôadministration, cette infrastructure sert depuis deux ans √† former les √©l√®ves de l‚ÄôENSAE et de l‚ÄôENSAI dans le cadre de leur formation en <em>data science</em>.</p>
<p>D√©but 2023, ce sont plus de 3000 agents et √©tudiants qui sont inscrits sur cette infrastructure avec, en moyenne, 300 utilisateurs hebdomadaires. L‚Äôinfrastructure de traitement propose 10 TB de RAM, 1100 CPU disponibles et 34 GPU. La capacit√© de stockage associ√©e est de 150 TB.</p>
<p>Pour les utilisations internes de donn√©es plus sensibles, l‚Äô√©quipe innovation de l‚ÄôInsee a rendu disponible le code source derri√®re le <code>SSP Cloud</code> dans le cadre d‚Äôun logiciel nomm√© <code>Onyxia</code> (https://www.onyxia.sh/). Ce logiciel est pens√© comme un kit qui peut √™tre install√© sur un <em>cluster</em> <code>Kubernetes</code>, technologie d√©taill√©e pr√©c√©demment.</p>
</section>
</section>
<section id="onyxia-en-bref" class="level2">
<h2 class="anchored" data-anchor-id="onyxia-en-bref">Onyxia en bref</h2>
<p><img src="onyxia_ecailles.svg" class="img-fluid"></p>
<p><code>Onyxia</code> propose principalement deux composants de valeur :</p>
<ul>
<li>une <strong>interface web</strong> qui agit comme la porte d‚Äôentr√©e du <em>data scientist</em> sur son datalab, lui facilitant l‚Äôacc√®s aux technologies cloud et lui permettant de d√©marrer ses environnements de traitement de la donn√©e. L‚Äôinterface ergonomique permet aux utilisateurs de donn√©es n√©ophytes de d√©marrer des services standardis√©s sans se pr√©occuper de la configuration mais aussi aux <em>data scientists</em> plus aguerris de b√©n√©ficier de vastes possibilit√©s de personnalisation du service.</li>
<li>des <strong>catalogues de logiciels</strong> : une petite vingtaine de services interactifs dont les plus utilis√©s sont <code>RStudio</code>, <code>Jupyter</code>, <code>VScode</code>, une quinzaine de services sp√©cialis√©s dans les bases de donn√©es (<code>Postgres</code>, <code>ElasticSearch</code>‚Ä¶), 5 services d‚Äôautomatisation (<code>MLflow</code>‚Ä¶) et 2 services de <em>dataviz</em> (<code>Redash</code> et <code>Superset</code>)</li>
</ul>
<p><img src="catalogue.svg" alt="Le catalogue Onyxia"></p>
<p><em>Le catalogue des services disponibles dans <code>Onyxia</code>.</em></p>
<p><br></p>
<p>Ces deux composants peuvent √™tre adapt√©s en fonction des besoins internes de chaque organisation. Tous les services interactifs sont automatiquement connect√©s √† l‚Äôespace de stockage <code>S3</code>, et au coffre de secret <code>Vault</code>. La gestion des droits d‚Äôacc√®s aux donn√©es stock√©es dans l‚Äôespace de stockage <code>S3</code> ou dans des services de bases de donn√©es (<code>ElasticSearch</code>, <code>PostGreSQL</code>‚Ä¶) est automatis√©e afin que chaque service puisse acc√©der aux donn√©es sur lesquelles l‚Äôutilisateur d√©tient des droits.</p>
<p><code>Onyxia</code> √©tant un ensemble mall√©able de logiciels conteneuris√©s, il est possible de ne pas adopter l‚Äôensemble des services propos√©s par l‚Äô√©quipe de l‚ÄôInsee qui maintient <code>Onyxia</code>. Il est √©galement possible de changer certaines des briques de base pour l‚Äôadapter √† des √©l√©ments d‚Äôinfrastructure interne. Par exemple, il est possible d‚Äôadapter la destination du service de stockage ou les configurations des environnements data science pour l‚Äôadapter √† des ressources.</p>
</section>
<section id="linterface-et-les-services-propos√©s-par-onyxia" class="level2">
<h2 class="anchored" data-anchor-id="linterface-et-les-services-propos√©s-par-onyxia">L‚Äôinterface et les services propos√©s par <code>Onyxia</code></h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption><em>Onyxia offre des marges de manoeuvre sur l‚Äôinterface</em></figcaption>
<p><img src="multiple_instances.svg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>L‚Äôune des principales forces d‚Äô<code>Onyxia</code> est d‚Äôoffrir une multiplicit√© de services diff√©rents avec une interconnexion entre eux g√©r√©e de mani√®re coh√©rente.</p>
<p>Les conteneurs sont d√©marr√©s comme des services √† la demande et la configuration automatique de ceux-ci permet d‚Äôassurer aux <em>data scientists</em> l‚Äôacc√®s aux donn√©es disponibles dans des espaces de stockage ou des bases de donn√©es cr√©√©es par l‚Äôutilisateur.</p>
<p>Le catalogue de services se pr√©sente par le biais d‚Äôun formulaire ergonomique o√π l‚Äôutilisateur choisit la brique qu‚Äôil d√©sire utiliser:</p>
<p><img src="onyxia_ui1.png" class="img-fluid"></p>
<p>Les <em>data scientists</em> et statisticiens n‚Äôont donc pas besoin de conna√Ætre les d√©tails du fonctionnement des briques techniques d‚Äô<code>Onyxia</code> pour utiliser la plateforme. Les √©l√©ments techniques comme la connexion au syst√®me de stockage sont, par d√©faut, d√©j√† configur√©s :</p>
<p><img src="onyxia_ui2.png" class="img-fluid"></p>
<p>L‚Äôinterface ergonomique permet de param√©trer certaines configurations si besoin, notamment les ressources √† disposition du conteneur. N√©anmoins l‚Äôallocation dynamique des ressources offre d√©j√† de la flexibilit√© :</p>
<p><img src="onyxia_ui3.png" class="img-fluid"></p>
<p>L‚Äôutilisateur a acc√®s √† l‚Äôensemble des services qu‚Äôil a ouvert depuis une page d√©di√©e :</p>
<p><img src="onyxia_ui4.png" class="img-fluid"></p>
<p>Les services interactifs comme <code>Jupyter</code>, <code>VSCode</code> ou <code>RStudio</code> permettent alors √† l‚Äôutilisateur d‚Äôacc√©der √† une interface pour ex√©cuter des traitements <code>Python</code> ou <code>R</code>.</p>
<p><img src="onyxia_ui5.png" class="img-fluid"></p>
<p>L‚Äôacc√®s aux donn√©es peut se faire depuis la ligne de commande (via un utilitaire <a href="https://min.io/docs/minio/linux/reference/minio-mc.html">Minio Client</a>) ou par un package <code>Python</code> ou <code>R</code> d√©di√© qui permet de traiter le syst√®me de stockage distant comme un syst√®me local. Les traitements sont ex√©cut√©s sur les serveurs de la plateforme qui h√©berge les notebooks, ind√©pendamment de la machine par laquelle l‚Äôutilisateur acc√®de au service. Par exemple, dans le cas du <code>SSPCloud</code>, les traitements sont ex√©cut√©s depuis des serveurs h√©berg√©s √† l‚ÄôInsee.</p>
</section>
<section id="la-communaut√©-onyxia" class="level2">
<h2 class="anchored" data-anchor-id="la-communaut√©-onyxia">La communaut√© <code>Onyxia</code></h2>
<p>Tous les composants sont propos√©s en <em>open source</em> par l‚ÄôInsee ce qui permet de f√©d√©rer une communaut√© d‚Äôutilisateurs et de d√©veloppeurs de ce produit. Il s‚Äôagit d‚Äôun bel exemple de mutualisation au sein de l‚Äô√âtat et au del√†. Les d√©p√¥ts peuvent √™tre retrouv√©s sur le <code>Github</code> de l‚Äô√©quipe innovation (celui de <a href="https://github.com/InseeFrLab/onyxia-web">l‚Äôinterface web</a>, celui des <a href="https://github.com/InseeFrLab/images-datascience">images pour la data-science</a>‚Ä¶). La communaut√© peut proposer de nouveaux services dans le catalogue.</p>
<p>Cette approche <em>bottom up</em> a d√©j√† permis d‚Äôadapter des services aux besoins des utilisateurs ou d‚Äôam√©liorer la solution gr√¢ce √† des retours des r√©-utilisateurs d‚Äô<code>Onyxia</code>.</p>
<!-----
<iframe width="100%" height="500px" marginheight="0" marginwidth="0" src="./template/index.html">
Fallback text here for unsupporting browsers, of which there are scant few.
</iframe>
----->
</section>
<section id="les-plateformes-bas√©es-sur-onyxia" class="level2">
<h2 class="anchored" data-anchor-id="les-plateformes-bas√©es-sur-onyxia">Les plateformes bas√©es sur Onyxia</h2>
<p>La plateforme d‚Äôorigine, le <code>SSPCloud</code>, est ouverte √† tous les agents de l‚Äô√âtat et √† plusieurs √©coles. Celle-ci est exclusivement limit√©e √† l‚Äôexploitation de donn√©es <em>open data</em>. Cette strat√©gie d‚Äôoffreur de services de traitement sur l‚Äôopen data permet de montrer l‚Äôexpertise de l‚ÄôInsee sur les sujets <em>data science</em>.</p>
<p>Les principaux usages de cette plateforme sont les suivants :</p>
<ul>
<li>la formation ;</li>
<li>l‚Äôorganisation de hackathons ;</li>
<li>la mise √† disposition de services innovants et visualisations utilisant de l‚Äôopen data ;</li>
</ul>
<p>Gr√¢ce √† la mise √† disposition de la solution <code>Onyxia</code> sur <code>Github</code>, il est n√©anmoins possible d‚Äôadapter cette plateforme pour des <em>datalab</em> internes, sur donn√©es plus sensibles.</p>
<p>L‚ÄôInsee n‚Äôest donc d√©sormais plus seul et f√©d√®re de nombreux acteurs autour de son projet. Fin 2021, <code>Eurostat</code> a √©t√© la premi√®re organisation en dehors de l‚ÄôInsee √† choisir <code>Onyxia</code> pour construire son <a href="https://github.com/eurostat/datalab"><em>Cloud Agnostic Data Lab</em></a>. Expertise France pour le projet <code>DATAFID</code> a fait le choix d‚ÄôOnyxia tout comme le CASD, le GENES ou encore le <em>BercyHub</em> avec le projet <code>Nubonyxia</code>.</p>
<p>D‚Äôautres organisations sont plus dans une phase de POC ou d‚Äô√©tude : l‚ÄôINS norv√©gien, Pole Emploi, Data4Good, le minist√®re de l‚ÄôInt√©rieur, le minist√®re de la Justice, l‚ÄôInria‚Ä¶</p>
<p>Dans le cadre du <a href="https://tosit.fr/">TOSIT</a>, association qui r√©unit de gros acteurs publics et priv√©s autour de solutions <em>open source</em>, un certain nombre d‚Äôentreprises s‚Äôint√©ressent √† <code>Onyxia</code>.</p>
</section>
<section id="vid√©o-de-pr√©sentation-donyxia" class="level2">
<h2 class="anchored" data-anchor-id="vid√©o-de-pr√©sentation-donyxia">Vid√©o de pr√©sentation d‚Äô<code>Onyxia</code></h2>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/zwKiO6LcIWE" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</section>
<section id="r√©f√©rences" class="level2">
<h2 class="anchored" data-anchor-id="r√©f√©rences">R√©f√©rences</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-davenport2022data" class="csl-entry" role="listitem">
Davenport, Thomas H, et DJ Patil. 2022. <span>¬´&nbsp;Is Data Scientist Still the Sexiest Job of the 21st Century?&nbsp;¬ª</span> <em>Harvard business review</em>. <a href="https://hbr.org/2022/07/is-data-scientist-still-the-sexiest-job-of-the-21st-century">https://hbr.org/2022/07/is-data-scientist-still-the-sexiest-job-of-the-21st-century</a>.
</div>
</div>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Notes de bas de page</h2>

<ol>
<li id="fn1"><p>On peut ajouter que cette question n‚Äôest pas exclusivement technologique. M√™me s‚Äôil est volontairement pol√©mique, l‚Äôarticle de <a href="https://motherduck.com/blog/big-data-is-dead/">Jordan Tigani ‚ÄúBig Data is Dead‚Äù</a> illustre bien le changement de paradigme du monde de la <em>tech</em>.<a href="#fnref1" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copi√©");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copi√©");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/user-nicolastlm-455756-0\.user\.lab\.sspcloud\.fr\/proxy\/4321\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>
