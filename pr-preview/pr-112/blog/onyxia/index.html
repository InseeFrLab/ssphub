<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Les technologies cloud sont incontournables dans lâ€™Ã©cosystÃ¨me de la donnÃ©e. Pour ne pas se rendre dÃ©pendante de fournisseurs de services externes, lâ€™Insee a dÃ©veloppÃ© un datalab avec des technologies Ã  la pointe pour ses data scientists. Le code source de celle-ci a Ã©tÃ© ouvert dans le cadre du projet Onyxia. Ce projet permet de fÃ©dÃ©rer une large communautÃ© dâ€™utilisateurs mais aussi dâ€™organisations intÃ©ressÃ©es par le dÃ©veloppement dâ€™une plateforme souveraine de data science.">

<title>Onyxia: lâ€™infrastructure cloud mÃ¨re des dragons â€“ SSPHub</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-fe39306e42976778068152c2bf72bcac.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Pas de rÃ©sultats",
    "search-matching-documents-text": "documents trouvÃ©s",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: white;
      }

      .quarto-title-block .quarto-title-banner {
        color: white;
background: #6886bb;
      }
</style>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">SSPHub</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Recherche"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Basculer la navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Accueil</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../event.html"> 
<span class="menu-text">Ã‰vÃ©nements</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../project.html"> 
<span class="menu-text">Projets</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../course.html"> 
<span class="menu-text">Ressources utiles</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-propos" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Ã€ propos</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-propos">    
        <li>
    <a class="dropdown-item" href="../../infolettre/infolettre.html">
 <span class="dropdown-text">Newsletters</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../about.html">
 <span class="dropdown-text">PrÃ©sentation du rÃ©seau</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../manifeste.html">
 <span class="dropdown-text">Manifeste du rÃ©seau</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://datalab.sspcloud.fr/"> 
<span class="menu-text">Le SSPCloud</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/InseeFrLab/ssphub"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <div id="quarto-announcement" data-announcement-id="8c899c87ea21742c798fea6eae88c782" class="alert alert-primary hidden"><i class="bi bi-bi-megaphone quarto-announcement-icon"></i><div class="quarto-announcement-content">
<p>ğŸ“ºï¸ Les prÃ©sentations et le replay de la journÃ©e du rÃ©seau, le 1<sup>er</sup> dÃ©cembre 2025, <a href="../../event/2025-12-01-network-day/index.html">sont disponibles</a></p>
</div><i class="bi bi-x-lg quarto-announcement-action"></i></div>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Onyxia: lâ€™infrastructure cloud mÃ¨re des dragons</h1>
            <p class="subtitle lead">Un projet autour dâ€™une infrastructure de data science Ã  la pointe</p>
                  <div>
        <div class="description">
          <p>Les technologies cloud sont incontournables dans lâ€™Ã©cosystÃ¨me de la donnÃ©e. Pour ne pas se rendre dÃ©pendante de fournisseurs de services externes, lâ€™Insee a dÃ©veloppÃ© un datalab avec des technologies Ã  la pointe pour ses data scientists. Le code source de celle-ci a Ã©tÃ© ouvert dans le cadre du projet Onyxia. Ce projet permet de fÃ©dÃ©rer une large communautÃ© dâ€™utilisateurs mais aussi dâ€™organisations intÃ©ressÃ©es par le dÃ©veloppement dâ€™une plateforme souveraine de data science.</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Insee</div>
                <div class="quarto-category">sspcloud</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">AuteurÂ·rice</div>
      <div class="quarto-title-meta-contents">
               <p>Lino Galiana </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Date de publication</div>
      <div class="quarto-title-meta-contents">
        <p class="date">10 mai 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sur cette page</h2>
   
  <ul>
  <li><a href="#contexte" id="toc-contexte" class="nav-link active" data-scroll-target="#contexte">Contexte</a></li>
  <li><a href="#de-hdfs-Ã -la-conteneurisation" id="toc-de-hdfs-Ã -la-conteneurisation" class="nav-link" data-scroll-target="#de-hdfs-Ã -la-conteneurisation">De HDFS Ã  la conteneurisation</a></li>
  <li><a href="#la-solution-onyxia" id="toc-la-solution-onyxia" class="nav-link" data-scroll-target="#la-solution-onyxia">La solution Onyxia</a>
  <ul class="collapse">
  <li><a href="#dun-cloud-de-ladministration-Ã -un-logiciel-ouvert" id="toc-dun-cloud-de-ladministration-Ã -un-logiciel-ouvert" class="nav-link" data-scroll-target="#dun-cloud-de-ladministration-Ã -un-logiciel-ouvert">Dâ€™un <em>cloud</em> de lâ€™administration Ã  un logiciel ouvert</a></li>
  </ul></li>
  <li><a href="#onyxia-en-bref" id="toc-onyxia-en-bref" class="nav-link" data-scroll-target="#onyxia-en-bref">Onyxia en bref</a></li>
  <li><a href="#linterface-et-les-services-proposÃ©s-par-onyxia" id="toc-linterface-et-les-services-proposÃ©s-par-onyxia" class="nav-link" data-scroll-target="#linterface-et-les-services-proposÃ©s-par-onyxia">Lâ€™interface et les services proposÃ©s par <code>Onyxia</code></a></li>
  <li><a href="#la-communautÃ©-onyxia" id="toc-la-communautÃ©-onyxia" class="nav-link" data-scroll-target="#la-communautÃ©-onyxia">La communautÃ© <code>Onyxia</code></a></li>
  <li><a href="#les-plateformes-basÃ©es-sur-onyxia" id="toc-les-plateformes-basÃ©es-sur-onyxia" class="nav-link" data-scroll-target="#les-plateformes-basÃ©es-sur-onyxia">Les plateformes basÃ©es sur Onyxia</a></li>
  <li><a href="#vidÃ©o-de-prÃ©sentation-donyxia" id="toc-vidÃ©o-de-prÃ©sentation-donyxia" class="nav-link" data-scroll-target="#vidÃ©o-de-prÃ©sentation-donyxia">VidÃ©o de prÃ©sentation dâ€™<code>Onyxia</code></a></li>
  <li><a href="#rÃ©fÃ©rences" id="toc-rÃ©fÃ©rences" class="nav-link" data-scroll-target="#rÃ©fÃ©rences">RÃ©fÃ©rences</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/InseeFrLab/ssphub/blob/main/blog/onyxia/index.qmd" class="toc-action"><i class="bi bi-github"></i>Voir la source</a></li><li><a href="https://github.com/InseeFrLab/ssphub/issues/new" class="toc-action"><i class="bi empty"></i>Faire part d'un problÃ¨me</a></li><li><a href="https://github.com/InseeFrLab/ssphub/edit/main/blog/onyxia/index.qmd" class="toc-action"><i class="bi empty"></i>Modifier cette page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><code>Onyxia</code> est un logiciel <em>open source</em> dÃ©veloppÃ© par lâ€™Insee (<a href="https://github.com/InseeFrLab/onyxia-web">disponible sur <code>Github</code> <i class="fa-brands fa-github"></i></a>) permettant de fournir un environnement de traitement de donnÃ©es Ã  lâ€™Ã©tat de lâ€™art. Principalement conÃ§u pour permettre le travail interactif des data scientists, lâ€™expÃ©rience fournie avec <code>Onyxia</code> favorise Ã©galement la reproductibilitÃ© des travaux et leur mise en production.</p>
<p>Le logiciel <code>Onyxia</code> est installÃ© par des organisations souhaitant crÃ©er un <em>datalab</em>, câ€™est-Ã -dire une plateforme interactive de traitement de donnÃ©es. Ces organisations ont toutes le point commun de vouloir construire une plateforme qui embrasse les technologies <em>cloud</em> que sont la conteneurisation et le stockage objet tout en mettant Ã  disposition celles-ci dans un environnement <em>user-friendly</em> oÃ¹ lâ€™interconnexion entre ces diffÃ©rentes briques est gÃ©rÃ©e de maniÃ¨re cohÃ©rente. Les technologies <em>cloud native</em> sont devenues indispensables dans lâ€™Ã©cosystÃ¨me de la donnÃ©e, du fait dâ€™une meilleure gestion des ressources de traitement ou de la capacitÃ© Ã  crÃ©er un environnement parfaitement reproductible pour une mise en production accÃ©lÃ©rÃ©e.</p>
<p>Ce <em>post</em> de blog a pour objectif de prÃ©senter la raison dâ€™Ãªtre dâ€™<code>Onyxia</code>, sa gÃ©nÃ¨se et les solutions quâ€™apporte cette infrastructure Ã  des irritants classiques des projets novateurs de data science.</p>
<section id="contexte" class="level2">
<h2 class="anchored" data-anchor-id="contexte">Contexte</h2>
<p>Lâ€™Ã©cosystÃ¨me de la data science est en mouvement accÃ©lÃ©rÃ© depuis 10 ans et le rÃ´le du <em>data scientist</em> dans les organisations valorisant de la donnÃ©e Ã©volue continuellement <span class="citation" data-cites="davenport2022data">(<a href="#ref-davenport2022data" role="doc-biblioref">Davenport et Patil 2022</a>)</span>. Les data scientists modernes sont amenÃ©s Ã  utiliser de plus en plus de langages et doivent Ãªtre capables de maÃ®triser plusieurs architectures informatiques. La frontiÃ¨re est ainsi moins nette que par le passÃ© entre statisticiens et informaticiens. De plus, les innovations rÃ©centes dans le monde du dÃ©veloppement logiciel, notamment lâ€™adoption massive de lâ€™approche <code>DevOps</code> - approche qui consiste Ã  automatiser la production de livrables dÃ¨s la conception du prototype - a Ã©galement fait Ã©voluer les pratiques des data scientists.</p>
<p>Ce besoin de ressources informatiques croissantes, de flexibilitÃ© dans le prototypage de solutions informatiques et lâ€™Ã©volution des pratiques consistant Ã  mettre Ã  disposition en continu des livrables ont eu des implications importantes sur les architectures informatiques dominantes dans lâ€™Ã©cosystÃ¨me de la donnÃ©e. Pour rÃ©pondre au besoin croissant de puissance de traitement, les serveurs partagÃ©s, organisÃ©s sous forme de <em>clusters</em>, se sont dÃ©veloppÃ©s dans de nombreuses organisations. AprÃ¨s avoir connue son heure de gloire au dÃ©but des annÃ©es 2010, lâ€™infrastructure <a href="https://openclassrooms.com/fr/courses/4467481-creez-votre-data-lake/4509426-decouvrez-le-systeme-de-fichiers-distribue-hdfs"><code>HDFS</code> (<em>Hadoop Distributed File System</em>)</a>, qui reposait sur des <em>clusters</em> oÃ¹ les donnÃ©es et la puissance de traitement Ã©taient distribuÃ©es et collocalisÃ©es, a laissÃ© place Ã  des infrastructures plus <em>scalables</em>, basÃ©es sur lâ€™approche de la conteneurisation.</p>
</section>
<section id="de-hdfs-Ã -la-conteneurisation" class="level2">
<h2 class="anchored" data-anchor-id="de-hdfs-Ã -la-conteneurisation">De HDFS Ã  la conteneurisation</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Cette partie plus technique dÃ©veloppe des Ã©lÃ©ments pour comprendre le succÃ¨s rÃ©cent des infrastructures conteneurisÃ©es.</p>
<p>Elle pourra intÃ©resser le lecteur curieux sur les fondements des infrastructures <em>cloud</em> modernes mais nâ€™est pas nÃ©cessaire Ã  la comprÃ©hension gÃ©nÃ©rale de lâ€™article.</p>
</div>
</div>
<p>La conteneurisation, qui repose sur lâ€™idÃ©e que les serveurs de stockage de la donnÃ©e peuvent Ãªtre dissociÃ©s de ceux effectuant les traitements, sert de fondement aux principales plateformes <em>cloud</em> actuelles fournissant des services Ã  la demande.</p>
<p>Ce nouveau paradigme part de deux constats. Le premier est que les Ã©changes de donnÃ©es entre les noeuds dâ€™un serveur sont aujourdâ€™hui peu coÃ»teux. Avec des flux rÃ©seaux suffisants et une technologie performante, il est donc possible dâ€™Ã©changer Ã  un coÃ»t modÃ©rÃ© de gros volumes de donnÃ©es au sein dâ€™une infrastructure. Le deuxiÃ¨me constat est que la maintenance dâ€™une infrastructure conteneurisÃ©e, faite pour Ãªtre trÃ¨s mallÃ©able, est plus lÃ©gÃ¨re que celle dâ€™une infrastructure basÃ©e sur des machines virtuelles ou sur les infrastructrures calibrÃ©es pour lâ€™analytique <em>big data</em> comme <code>HDFS</code> reposant sur la collocalisation des donnÃ©es et des traitements<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<p>Les donnÃ©es Ã©tant stockÃ©es sur des serveurs diffÃ©rents de ceux exÃ©cutant les traitements, lâ€™accÃ¨s Ã  celles-ci se fait Ã  travers des API qui permettent de traiter le systÃ¨me de stockage distant comme un systÃ¨me de fichiers classique. <code>Onyxia</code> a adoptÃ© une implÃ©mentation <em>open source</em> du systÃ¨me de stockage <a href="https://fr.wikipedia.org/wiki/Amazon_S3"><code>S3</code></a> appelÃ©e <a href="https://min.io/"><code>MinIO</code></a>.</p>
<p>En ce qui concerne le traitement des donnÃ©es, le fait dâ€™utiliser un systÃ¨me de conteneurs, câ€™est-Ã -dire une configuration logicielle portable minimaliste prÃªte Ã  lâ€™emploi (par opposition aux machines virtuelles qui impliquent un systÃ¨me dâ€™exploitation complet), offre une grande libertÃ© sur le choix des logiciels de traitement. De nombreuses technologies <em>open source</em> devenues standards dans le monde de la <em>data science</em> (<code>Jupyter</code>, <code>RStudio</code>, <code>ElasticSearch</code>â€¦) existent dÃ©jÃ  sous cette forme et peuvent ainsi Ãªtre adoptÃ©es dans une telle infrastructure pour fournir des services prÃªts-Ã -lâ€™emploi pour les data scientists. La mise en musique de toutes ces petites boites auto-suffisantes, notamment lâ€™optimisation des ressources concurrentes sur un serveur, est permise par la technologie dâ€™orchestration <a href="https://kubernetes.io/fr/"><code>Kubernetes</code></a>.</p>
<p><br></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption><em>Centralisation des ressources par <code>Onyxia</code></em></figcaption>
<p><img src="onyxia_logic.svg" class="img-fluid figure-img"></p>
</figure>
</div>
<p><br></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Plus de dÃ©tails pour comprendre le changement de paradigme vers la conteuneurisation ğŸ‘‡
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Les infrastructures <em>big data</em> reposent sur le principe du <em>cluster</em> (grappe) informatique. Des serveurs sont connectÃ©s entre eux, ce qui forme de maniÃ¨re imagÃ©e une grappe. Cette interconnexion de plusieurs serveurs entre eux peut se faire au niveau :</p>
<ul>
<li>du <strong>stockage</strong> : les donnÃ©es volumineuses ne sont pas stockÃ©es sur un seul serveur mais au contraire rÃ©parties ;</li>
<li>du <strong>traitement</strong> : les calculs sont effectuÃ©s par blocs sur plusieurs serveurs et le rÃ©sultat de ceux-ci est ensuite transmis Ã  un serveur maÃ®tre.</li>
</ul>
<p>Le systÃ¨me <em>Hadoop Distributed File System</em> a Ã©tÃ© pensÃ© pour tirer parti de lâ€™algorithme de traitement parallÃ©lisÃ© <a href="https://fr.wikipedia.org/wiki/MapReduce"><code>MapReduce</code></a> proposÃ© en 2004 par <code>Google</code>. Les fichiers volumineux sont fractionnÃ©s et rÃ©partis sur plusieurs serveurs.</p>
<p><img src="https://i0.wp.com/datascientest.com/wp-content/uploads/2021/04/illu_schema_mapreduce-04.png?w=1024&amp;ssl=1" class="img-fluid"></p>
<p><em>Fonctionnement dâ€™une architecture <code>MapReduce</code> (source: <a href="https://datascientest.com/mapreduce">Datascientest</a>)</em></p>
<p>La spÃ©cificitÃ© de lâ€™architecture <code>HDFS</code> est que non seulement le stockage est distribuÃ© mais Ã©galement aussi la puissance de traitement associÃ©e. On parle Ã  ce propos de <strong>collocalisation</strong> : les traitements ont lieu sur les mÃªmes serveurs que ceux oÃ¹ sont stockÃ©s les donnÃ©es. Cela permet de rÃ©duire les mouvements de donnÃ©es (<em>shuffle</em> dans lâ€™image ci-dessus) qui sont coÃ»teux du point de vue de la performance. Cette collocalisation a permis au systÃ¨me <code>HDFS</code> de devenir, au dÃ©but de la dÃ©cennie 2010, le paradigme dominant. En tirant parti de la parallÃ©lisation permise par des langages trÃ¨s efficaces comme <code>Spark</code> tout en limitant les Ã©changes rÃ©seaux pouvant faire perdre en performance, cette architecture a attirÃ© au-delÃ  de lâ€™Ã©cosystÃ¨me du <em>big data</em>.</p>
<p>Le systÃ¨me HDFS prÃ©sente nÃ©anmoins certaines limites qui expliquent sa perte de succÃ¨s avec lâ€™Ã©mergence dâ€™un nouveau paradigme plus flexible.</p>
<p>En premier lieu, ce systÃ¨me nÃ©cessite beaucoup de ressources du fait de son <em>design</em>. Comme les traitements sont lourds et partagÃ©s pour des usages concurrents, les noeuds constituant le <em>cluster</em> peuvent subir des arrÃªts Ã  cause de surcharge des ressources. Pour tenir compte de la nature instable de cette infrastructure <em>big data</em>, les fichiers sont dupliquÃ©s. Ainsi, lors dâ€™une erreur sur le serveur gÃ©nÃ©rant un arrÃªt du nÅ“ud (par exemple Ã  cause de traitements trop gourmands), les traitements sur lâ€™ensemble des donnÃ©es sont sÃ©curisÃ©s Ã©vitant Ã©galement la perte partielle ou totale de ces derniÃ¨res.</p>
<p>Lâ€™implication est que les donnÃ©es, dÃ©jÃ  volumineuses, sont dupliquÃ©es plusieurs fois impliquant des architectures assez monumentales. Si la duplication de la donnÃ©e nâ€™est pas en soi choquante afin dâ€™Ã©viter la perte de donnÃ©es, cela a un effet pervers dans un systÃ¨me de collocalisation. A chaque ajout de noeuds pour le stockage de donnÃ©es, il est Ã©galement nÃ©cessaire dâ€™ajouter des ressources pour les traiter. Il est donc compliquÃ© de dÃ©corrÃ©ler lâ€™ajout de ressources de stockage et de traitement. Cette absence de flexibilitÃ© est pÃ©nalisante dans un monde oÃ¹ les donnÃ©es sont mises Ã  jour frÃ©quemment et oÃ¹ les technologies de traitement, donc les besoins associÃ©s, Ã©voluent rapidement. Les infrastructures <code>HDFS</code> sont donc lourdes Ã  changer, que ce soit pour ajouter des ressources ou faire Ã©voluer les distributions logicielles prÃ©sentes dessus.</p>
<p>Le deuxiÃ¨me facteur qui a favorisÃ© le changement de paradigme est lâ€™amÃ©lioration des Ã©changes rÃ©seaux. Il nâ€™est plus aussi coÃ»teux que par le passÃ© de transfÃ©rer des volumes importants de donnÃ©es au sein dâ€™une infrastructure. Cela facilite la dÃ©corrÃ©lation entre environnement de stockage et de traitement.</p>
<p>Cette sÃ©paration des environnements de stockage et de traitement permet alors dâ€™adopter pour chacun les technologies les plus performantes. Dans le domaine du stockage, celle qui a rencontrÃ© le plus de succÃ¨s est le systÃ¨me de stockage <a href="https://aws.amazon.com/fr/s3/"><code>S3</code></a> dÃ©veloppÃ© par Amazon. Lâ€™implÃ©mentation <em>open source</em> du systÃ¨me S3 est <a href="https://min.io/"><code>MinIO</code></a>, utilisÃ©e par <code>Onyxia</code>.</p>
<p>Dans le domaine du traitement, la technologie la plus performante dÃ©pend de la nature de la tÃ¢che rÃ©alisÃ©e. Selon quâ€™on dÃ©sire effectuer de la recherche textuelle, des visualisations de donnÃ©es ou de lâ€™analyse dâ€™image, on ne va pas vouloir utiliser la mÃªme technologie. Pour mettre Ã  disposition des logiciels sur un serveur, il existe principalement deux approches concurrentes.</p>
<p>La premiÃ¨re repose sur le principe des machines virtuelles. Cette approche nâ€™est pas nouvelle et de nombreuses organisations ont proposÃ© ou proposent encore ce type dâ€™infrastructures pour des serveurs collectifs de traitement. Cette approche est nÃ©anmoins lourde : elle nÃ©cessite un systÃ¨me dâ€™exploitation complet dont il faudra ensuite adapter la configuration lors de lâ€™installation de chaque logiciel. Plusieurs logiciels coexistent donc dans ce systÃ¨me dâ€™exploitation mÃªme si un seul, par exemple, <code>Python</code>, est utilisÃ©. Les machines virtuelles sont des infrastructures assez polluantes puisque pour faire fonctionner un systÃ¨me dâ€™exploitation dans son ensemble, il est nÃ©cessaire de mobiliser des ressources plus importantes que celles seulement nÃ©cessaires aux traitements. De plus, la configuration dâ€™un systÃ¨me dâ€™exploitation, et notamment, la gestion de la dÃ©pendance de multiples logiciels Ã  des configurations systÃ¨mes qui peuvent ne pas correspondre, nâ€™est pas triviale. Il est donc lourd de faire Ã©voluer une infrastructure reposant sur des machines virtuelles. Lâ€™absence de flexibilitÃ© dâ€™une infrastructure reposant sur le principe des machines virtuelles est pÃ©nalisante dans un Ã©cosystÃ¨me mouvant comme celui de la <em>data science</em>, oÃ¹ une partie importante du travail de prototypage consiste Ã  tester plusieurs technologies pour dÃ©terminer celle sâ€™intÃ©grant le mieux dans un processus de traitement de donnÃ©es.</p>
<p>Le systÃ¨me de la conteneurisation a justement Ã©tÃ© pensÃ© pour cela : plutÃ´t quâ€™installer de nombreuses librairies au niveau du systÃ¨me, pour une fraction dâ€™utilisateurs limitÃ©e Ã  chacune, il est plus intÃ©ressant de crÃ©er des environnements complets qui vont exister de maniÃ¨re conjointe. Chaque <em>framework</em> va Ãªtre construit comme un conteneur autosuffisant avec un systÃ¨me dâ€™exploitation minime et un nombre minimal de couches de configurations supplÃ©mentaires. Un <em>framework</em> est livrÃ© sous la forme dâ€™une image <a href="https://fr.wikipedia.org/wiki/Docker_(logiciel)"><code>Docker</code></a>, une technologie qui permet dâ€™empaqueter un logiciel et ses dÃ©pendances sous la forme de boites minimalistes et les mettre Ã  disposition facilement pour une rÃ©utilisation. Il existe par exemple des images <code>Docker</code> pour pouvoir utiliser <code>RStudio</code>, <code>Jupyter</code>, <code>VSCode</code> avec des configurations minimales afin dâ€™exÃ©cuter du <code>Python</code> ou du <code>R</code>. A partir de celles-ci, lâ€™utilisateur qui dÃ©sire des configurations supplÃ©mentaires peut ajouter les couches qui lui sont utiles.</p>
<p>Mais les images <code>Docker</code> ne se rÃ©duisent pas Ã  la mise Ã  disposition dâ€™environnements de dÃ©veloppement. Une partie des technologies les plus apprÃ©ciÃ©es de lâ€™Ã©cosystÃ¨me de la data science sont Ã©galement livrÃ©es sous forme dâ€™images <code>Docker</code>. Par exemple, le moteur de recherche <code>ElasticSearch</code>, trÃ¨s utilisÃ© pour la recherche textuelle, peut Ãªtre empaquetÃ© dans une image <code>Docker</code>. Le logiciel <code>Onyxia</code> propose dÃ¨s lors, dans un catalogue vivant, un certain nombre de logiciels trÃ¨s utiles pour les <em>data scientists</em> ayant fait lâ€™objet dâ€™un tel empaquetage. Les nombreuses images <code>Docker</code> servant Ã  crÃ©er des services pour les <em>data scientists</em> sont disponibles en <em>open source</em> sur <a href="https://github.com/InseeFrLab/images-datascience"><code>Github</code></a>.</p>
<p>Pour organiser sur un serveur la coexistence de multiples utilisateurs de services gourmands en ressource, la solution <a href="https://kubernetes.io/fr/"><code>Kubernetes</code></a> fait aujourdâ€™hui office de rÃ©fÃ©rence. Entre sa crÃ©ation en 2014 et aujourdâ€™hui, cette solution dâ€™orchestration, câ€™est-Ã -dire de gestion dâ€™une infrastructure, est devenue incontournable. Outre son allocation dynamique des ressources, elle permet de transformer facilement le livrable dâ€™une chaine de traitement en application disponible en continu. Ceci est particuliÃ¨rement adaptÃ© dans un contexte de diversification des livrables fournis par les <em>data scientists</em> (API, application web, modÃ¨leâ€¦) et dâ€™adoption dâ€™une dÃ©marche <code>DevOps</code> voire <code>MLOps</code>.</p>
</div>
</div>
</div>
</section>
<section id="la-solution-onyxia" class="level2">
<h2 class="anchored" data-anchor-id="la-solution-onyxia">La solution Onyxia</h2>
<section id="dun-cloud-de-ladministration-Ã -un-logiciel-ouvert" class="level3">
<h3 class="anchored" data-anchor-id="dun-cloud-de-ladministration-Ã -un-logiciel-ouvert">Dâ€™un <em>cloud</em> de lâ€™administration Ã  un logiciel ouvert</h3>
<p>Pour permettre aux <em>data scientists</em> des administrations franÃ§aises de bÃ©nÃ©ficier de technologies <em>cloud</em> sans Ãªtre dÃ©pendant dâ€™un fournisseur de service privÃ©, lâ€™Ã©quipe innovation de lâ€™Insee a eu lâ€™idÃ©e de crÃ©er un <em>datalab</em> basÃ© sur la philosophie de la conteneurisation en mobilisant exclusivement des composants open-source.</p>
<p>Ce <em>datalab</em>, nÃ© Ã  lâ€™Insee en 2018, a Ã©tÃ© ouvert Ã  lâ€™administration publique sous la forme dâ€™une instance https://www.sspcloud.fr/ Ã  condition dâ€™utiliser des donnÃ©es ouvertes. En plus des agents dÃ©jÃ  en poste dans lâ€™administration, cette infrastructure sert depuis deux ans Ã  former les Ã©lÃ¨ves de lâ€™ENSAE et de lâ€™ENSAI dans le cadre de leur formation en <em>data science</em>.</p>
<p>DÃ©but 2023, ce sont plus de 3000 agents et Ã©tudiants qui sont inscrits sur cette infrastructure avec, en moyenne, 300 utilisateurs hebdomadaires. Lâ€™infrastructure de traitement propose 10 TB de RAM, 1100 CPU disponibles et 34 GPU. La capacitÃ© de stockage associÃ©e est de 150 TB.</p>
<p>Pour les utilisations internes de donnÃ©es plus sensibles, lâ€™Ã©quipe innovation de lâ€™Insee a rendu disponible le code source derriÃ¨re le <code>SSP Cloud</code> dans le cadre dâ€™un logiciel nommÃ© <code>Onyxia</code> (https://www.onyxia.sh/). Ce logiciel est pensÃ© comme un kit qui peut Ãªtre installÃ© sur un <em>cluster</em> <code>Kubernetes</code>, technologie dÃ©taillÃ©e prÃ©cÃ©demment.</p>
</section>
</section>
<section id="onyxia-en-bref" class="level2">
<h2 class="anchored" data-anchor-id="onyxia-en-bref">Onyxia en bref</h2>
<p><img src="onyxia_ecailles.svg" class="img-fluid"></p>
<p><code>Onyxia</code> propose principalement deux composants de valeur :</p>
<ul>
<li>une <strong>interface web</strong> qui agit comme la porte dâ€™entrÃ©e du <em>data scientist</em> sur son datalab, lui facilitant lâ€™accÃ¨s aux technologies cloud et lui permettant de dÃ©marrer ses environnements de traitement de la donnÃ©e. Lâ€™interface ergonomique permet aux utilisateurs de donnÃ©es nÃ©ophytes de dÃ©marrer des services standardisÃ©s sans se prÃ©occuper de la configuration mais aussi aux <em>data scientists</em> plus aguerris de bÃ©nÃ©ficier de vastes possibilitÃ©s de personnalisation du service.</li>
<li>des <strong>catalogues de logiciels</strong> : une petite vingtaine de services interactifs dont les plus utilisÃ©s sont <code>RStudio</code>, <code>Jupyter</code>, <code>VScode</code>, une quinzaine de services spÃ©cialisÃ©s dans les bases de donnÃ©es (<code>Postgres</code>, <code>ElasticSearch</code>â€¦), 5 services dâ€™automatisation (<code>MLflow</code>â€¦) et 2 services de <em>dataviz</em> (<code>Redash</code> et <code>Superset</code>)</li>
</ul>
<p><img src="catalogue.svg" alt="Le catalogue Onyxia"></p>
<p><em>Le catalogue des services disponibles dans <code>Onyxia</code>.</em></p>
<p><br></p>
<p>Ces deux composants peuvent Ãªtre adaptÃ©s en fonction des besoins internes de chaque organisation. Tous les services interactifs sont automatiquement connectÃ©s Ã  lâ€™espace de stockage <code>S3</code>, et au coffre de secret <code>Vault</code>. La gestion des droits dâ€™accÃ¨s aux donnÃ©es stockÃ©es dans lâ€™espace de stockage <code>S3</code> ou dans des services de bases de donnÃ©es (<code>ElasticSearch</code>, <code>PostGreSQL</code>â€¦) est automatisÃ©e afin que chaque service puisse accÃ©der aux donnÃ©es sur lesquelles lâ€™utilisateur dÃ©tient des droits.</p>
<p><code>Onyxia</code> Ã©tant un ensemble mallÃ©able de logiciels conteneurisÃ©s, il est possible de ne pas adopter lâ€™ensemble des services proposÃ©s par lâ€™Ã©quipe de lâ€™Insee qui maintient <code>Onyxia</code>. Il est Ã©galement possible de changer certaines des briques de base pour lâ€™adapter Ã  des Ã©lÃ©ments dâ€™infrastructure interne. Par exemple, il est possible dâ€™adapter la destination du service de stockage ou les configurations des environnements data science pour lâ€™adapter Ã  des ressources.</p>
</section>
<section id="linterface-et-les-services-proposÃ©s-par-onyxia" class="level2">
<h2 class="anchored" data-anchor-id="linterface-et-les-services-proposÃ©s-par-onyxia">Lâ€™interface et les services proposÃ©s par <code>Onyxia</code></h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption><em>Onyxia offre des marges de manoeuvre sur lâ€™interface</em></figcaption>
<p><img src="multiple_instances.svg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Lâ€™une des principales forces dâ€™<code>Onyxia</code> est dâ€™offrir une multiplicitÃ© de services diffÃ©rents avec une interconnexion entre eux gÃ©rÃ©e de maniÃ¨re cohÃ©rente.</p>
<p>Les conteneurs sont dÃ©marrÃ©s comme des services Ã  la demande et la configuration automatique de ceux-ci permet dâ€™assurer aux <em>data scientists</em> lâ€™accÃ¨s aux donnÃ©es disponibles dans des espaces de stockage ou des bases de donnÃ©es crÃ©Ã©es par lâ€™utilisateur.</p>
<p>Le catalogue de services se prÃ©sente par le biais dâ€™un formulaire ergonomique oÃ¹ lâ€™utilisateur choisit la brique quâ€™il dÃ©sire utiliser:</p>
<p><img src="onyxia_ui1.png" class="img-fluid"></p>
<p>Les <em>data scientists</em> et statisticiens nâ€™ont donc pas besoin de connaÃ®tre les dÃ©tails du fonctionnement des briques techniques dâ€™<code>Onyxia</code> pour utiliser la plateforme. Les Ã©lÃ©ments techniques comme la connexion au systÃ¨me de stockage sont, par dÃ©faut, dÃ©jÃ  configurÃ©s :</p>
<p><img src="onyxia_ui2.png" class="img-fluid"></p>
<p>Lâ€™interface ergonomique permet de paramÃ©trer certaines configurations si besoin, notamment les ressources Ã  disposition du conteneur. NÃ©anmoins lâ€™allocation dynamique des ressources offre dÃ©jÃ  de la flexibilitÃ© :</p>
<p><img src="onyxia_ui3.png" class="img-fluid"></p>
<p>Lâ€™utilisateur a accÃ¨s Ã  lâ€™ensemble des services quâ€™il a ouvert depuis une page dÃ©diÃ©e :</p>
<p><img src="onyxia_ui4.png" class="img-fluid"></p>
<p>Les services interactifs comme <code>Jupyter</code>, <code>VSCode</code> ou <code>RStudio</code> permettent alors Ã  lâ€™utilisateur dâ€™accÃ©der Ã  une interface pour exÃ©cuter des traitements <code>Python</code> ou <code>R</code>.</p>
<p><img src="onyxia_ui5.png" class="img-fluid"></p>
<p>Lâ€™accÃ¨s aux donnÃ©es peut se faire depuis la ligne de commande (via un utilitaire <a href="https://min.io/docs/minio/linux/reference/minio-mc.html">Minio Client</a>) ou par un package <code>Python</code> ou <code>R</code> dÃ©diÃ© qui permet de traiter le systÃ¨me de stockage distant comme un systÃ¨me local. Les traitements sont exÃ©cutÃ©s sur les serveurs de la plateforme qui hÃ©berge les notebooks, indÃ©pendamment de la machine par laquelle lâ€™utilisateur accÃ¨de au service. Par exemple, dans le cas du <code>SSPCloud</code>, les traitements sont exÃ©cutÃ©s depuis des serveurs hÃ©bergÃ©s Ã  lâ€™Insee.</p>
</section>
<section id="la-communautÃ©-onyxia" class="level2">
<h2 class="anchored" data-anchor-id="la-communautÃ©-onyxia">La communautÃ© <code>Onyxia</code></h2>
<p>Tous les composants sont proposÃ©s en <em>open source</em> par lâ€™Insee ce qui permet de fÃ©dÃ©rer une communautÃ© dâ€™utilisateurs et de dÃ©veloppeurs de ce produit. Il sâ€™agit dâ€™un bel exemple de mutualisation au sein de lâ€™Ã‰tat et au delÃ . Les dÃ©pÃ´ts peuvent Ãªtre retrouvÃ©s sur le <code>Github</code> de lâ€™Ã©quipe innovation (celui de <a href="https://github.com/InseeFrLab/onyxia-web">lâ€™interface web</a>, celui des <a href="https://github.com/InseeFrLab/images-datascience">images pour la data-science</a>â€¦). La communautÃ© peut proposer de nouveaux services dans le catalogue.</p>
<p>Cette approche <em>bottom up</em> a dÃ©jÃ  permis dâ€™adapter des services aux besoins des utilisateurs ou dâ€™amÃ©liorer la solution grÃ¢ce Ã  des retours des rÃ©-utilisateurs dâ€™<code>Onyxia</code>.</p>
<!-----
<iframe width="100%" height="500px" marginheight="0" marginwidth="0" src="./template/index.html">
Fallback text here for unsupporting browsers, of which there are scant few.
</iframe>
----->
</section>
<section id="les-plateformes-basÃ©es-sur-onyxia" class="level2">
<h2 class="anchored" data-anchor-id="les-plateformes-basÃ©es-sur-onyxia">Les plateformes basÃ©es sur Onyxia</h2>
<p>La plateforme dâ€™origine, le <code>SSPCloud</code>, est ouverte Ã  tous les agents de lâ€™Ã‰tat et Ã  plusieurs Ã©coles. Celle-ci est exclusivement limitÃ©e Ã  lâ€™exploitation de donnÃ©es <em>open data</em>. Cette stratÃ©gie dâ€™offreur de services de traitement sur lâ€™open data permet de montrer lâ€™expertise de lâ€™Insee sur les sujets <em>data science</em>.</p>
<p>Les principaux usages de cette plateforme sont les suivants :</p>
<ul>
<li>la formation ;</li>
<li>lâ€™organisation de hackathons ;</li>
<li>la mise Ã  disposition de services innovants et visualisations utilisant de lâ€™open data ;</li>
</ul>
<p>GrÃ¢ce Ã  la mise Ã  disposition de la solution <code>Onyxia</code> sur <code>Github</code>, il est nÃ©anmoins possible dâ€™adapter cette plateforme pour des <em>datalab</em> internes, sur donnÃ©es plus sensibles.</p>
<p>Lâ€™Insee nâ€™est donc dÃ©sormais plus seul et fÃ©dÃ¨re de nombreux acteurs autour de son projet. Fin 2021, <code>Eurostat</code> a Ã©tÃ© la premiÃ¨re organisation en dehors de lâ€™Insee Ã  choisir <code>Onyxia</code> pour construire son <a href="https://github.com/eurostat/datalab"><em>Cloud Agnostic Data Lab</em></a>. Expertise France pour le projet <code>DATAFID</code> a fait le choix dâ€™Onyxia tout comme le CASD, le GENES ou encore le <em>BercyHub</em> avec le projet <code>Nubonyxia</code>.</p>
<p>Dâ€™autres organisations sont plus dans une phase de POC ou dâ€™Ã©tude : lâ€™INS norvÃ©gien, Pole Emploi, Data4Good, le ministÃ¨re de lâ€™IntÃ©rieur, le ministÃ¨re de la Justice, lâ€™Inriaâ€¦</p>
<p>Dans le cadre du <a href="https://tosit.fr/">TOSIT</a>, association qui rÃ©unit de gros acteurs publics et privÃ©s autour de solutions <em>open source</em>, un certain nombre dâ€™entreprises sâ€™intÃ©ressent Ã  <code>Onyxia</code>.</p>
</section>
<section id="vidÃ©o-de-prÃ©sentation-donyxia" class="level2">
<h2 class="anchored" data-anchor-id="vidÃ©o-de-prÃ©sentation-donyxia">VidÃ©o de prÃ©sentation dâ€™<code>Onyxia</code></h2>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/zwKiO6LcIWE" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</section>
<section id="rÃ©fÃ©rences" class="level2">
<h2 class="anchored" data-anchor-id="rÃ©fÃ©rences">RÃ©fÃ©rences</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-davenport2022data" class="csl-entry" role="listitem">
Davenport, Thomas H, et DJ Patil. 2022. <span>Â«&nbsp;Is Data Scientist Still the Sexiest Job of the 21st Century?&nbsp;Â»</span> <em>Harvard business review</em>. <a href="https://hbr.org/2022/07/is-data-scientist-still-the-sexiest-job-of-the-21st-century">https://hbr.org/2022/07/is-data-scientist-still-the-sexiest-job-of-the-21st-century</a>.
</div>
</div>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Notes de bas de page</h2>

<ol>
<li id="fn1"><p>On peut ajouter que cette question nâ€™est pas exclusivement technologique. MÃªme sâ€™il est volontairement polÃ©mique, lâ€™article de <a href="https://motherduck.com/blog/big-data-is-dead/">Jordan Tigani â€œBig Data is Deadâ€</a> illustre bien le changement de paradigme du monde de la <em>tech</em>.<a href="#fnref1" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "CopiÃ©");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "CopiÃ©");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/InseeFrLab\.github\.io\/ssphub\/pr-preview\/pr-112\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/InseeFrLab/ssphub/blob/main/blog/onyxia/index.qmd" class="toc-action"><i class="bi bi-github"></i>Voir la source</a></li><li><a href="https://github.com/InseeFrLab/ssphub/issues/new" class="toc-action"><i class="bi empty"></i>Faire part d'un problÃ¨me</a></li><li><a href="https://github.com/InseeFrLab/ssphub/edit/main/blog/onyxia/index.qmd" class="toc-action"><i class="bi empty"></i>Modifier cette page</a></li></ul></div></div></div></footer></body></html>